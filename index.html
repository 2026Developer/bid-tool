<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ•æ ‡ä»·æ ¼è¯„åˆ†ä¼°ç®—å·¥å…· - å•†ä¸šç‰ˆ</title>
<meta name="version" content="3.0">
<meta name="update-check-url" content="https://raw.githubusercontent.com/[ä½ çš„ç”¨æˆ·å]/[ä»“åº“å]/main/version.json">
    <style>
        /* æ‰€æœ‰CSSæ ·å¼å®Œæ•´ä¿ç•™ */
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .toolbox-container {
            max-width: 1400px;
            margin: 0 auto 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 20px;
        }
        
        .toolbox-title {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }
        
        .toolbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .tool-item {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            color: #333;
            display: block;
        }
        
        .tool-item:hover {
            background-color: #e3f2fd;
            border-color: #3498db;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .tool-icon {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #3498db;
        }
        
        .tool-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 5px;
        }
        
        .tool-desc {
            font-size: 0.8rem;
            color: #7f8c8d;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            padding: 25px;
            position: relative;
        }
        
        /* ä¿®æ”¹ï¼šä½¿ç”¨æ¬¡æ•°è®¡æ•°å™¨æ”¾åœ¨å·¦è¾¹ */
        .usage-counter {
            position: absolute;
            top: 20px;
            left: 25px;
            background-color: #e74c3c;
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .usage-counter:hover {
            background-color: #c0392b;
            transform: scale(1.05);
        }
        
        .usage-counter.free {
            background-color: #2ecc71;
        }
        
        .usage-counter.free:hover {
            background-color: #27ae60;
        }
        
        /* ä¿®æ”¹ï¼šå¼€å‘è€…æ ‡è®°æ”¾åœ¨å³è¾¹ */
        .developer-tag {
            position: absolute;
            top: 20px;
            right: 25px;
            background-color: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .developer-tag:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }
        
        /* é‡æ–°è®¾è®¡çš„æ”¯ä»˜å¼¹çª— */
        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .payment-modal.active {
            display: flex;
        }
        
        .payment-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .payment-content h2 {
            color: #e74c3c;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }
        
        .payment-subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 25px;
            font-size: 16px;
        }
        
        .payment-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }
        
        @media (max-width: 768px) {
            .payment-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        .payment-left {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .payment-right {
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e0e0e0;
        }
        
        .donation-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .donation-option {
            background-color: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }
        
        .donation-option:hover {
            border-color: #3498db;
            background-color: #e3f2fd;
        }
        
        .donation-option.selected {
            border-color: #2ecc71;
            background-color: #d5f4e6;
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.2);
        }
        
        .donation-amount {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .donation-times {
            font-size: 16px;
            color: #27ae60;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .donation-description {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .payment-qrcode {
            text-align: center;
            margin: 20px 0;
        }
        
        .payment-qrcode img {
            max-width: 200px;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background-color: white;
        }
        
        .payment-instructions {
            margin-top: 20px;
        }
        
        .payment-instructions h4 {
            color: #2980b9;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .payment-instructions ol {
            margin: 10px 0;
            padding-left: 20px;
            font-size: 14px;
        }
        
        .payment-instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .machine-code-section {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px dashed #f39c12;
        }
        
        .machine-code-section h4 {
            color: #d68910;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .machine-code-display {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            word-break: break-all;
            font-size: 14px;
        }
        
        .btn-copy-machine {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn-copy-machine:hover {
            background-color: #2980b9;
        }
        
        .contact-info {
            font-size: 13px;
            color: #7f8c8d;
            margin-top: 10px;
        }
        
        .contact-info strong {
            color: #2c3e50;
        }
        
        .btn-close-payment {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            width: 100%;
            font-size: 16px;
        }
        
        .btn-close-payment:hover {
            background-color: #7f8c8d;
        }
        
        .payment-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .payment-actions {
                flex-direction: column;
            }
        }
        
        .btn-pay {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            font-size: 16px;
        }
        
        .btn-pay:hover {
            background-color: #27ae60;
        }
        
        .btn-pay:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .payment-notice {
            background-color: #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #fdcb6e;
            font-size: 14px;
        }
        
        .payment-notice strong {
            color: #e74c3c;
        }
        
        .payment-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }
        
        .payment-success.active {
            display: block;
        }
        
        /* æ–°å¢ï¼šæˆæƒç è¾“å…¥å¼¹çª— */
        .license-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .license-modal.active {
            display: flex;
        }
        
        .license-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .license-content h2 {
            color: #9b59b6;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }
        
        .license-subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 25px;
            font-size: 16px;
        }
        
        .license-instructions {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #9b59b6;
        }
        
        .license-instructions h4 {
            color: #8e44ad;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .license-instructions ol {
            margin: 10px 0;
            padding-left: 20px;
            font-size: 14px;
        }
        
        .license-instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .license-input-section {
            margin-bottom: 25px;
        }
        
        .license-input-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        .license-input-section textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            min-height: 120px;
            resize: vertical;
        }
        
        .license-input-section textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .license-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .license-actions {
                flex-direction: column;
            }
        }
        
        .btn-activate {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            font-size: 16px;
        }
        
        .btn-activate:hover {
            background-color: #27ae60;
        }
        
        .btn-activate:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .btn-close-license {
            background-color: #95a5a6;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            font-size: 16px;
        }
        
        .btn-close-license:hover {
            background-color: #7f8c8d;
        }
        
        .license-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            font-size: 14px;
            text-align: center;
            display: none;
        }
        
        .license-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .license-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .license-status.verifying {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #bbdefb;
            display: block;
        }
        
        .offline-auth-section {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border: 1px solid #3498db;
        }
        
        .offline-auth-section h4 {
            color: #2980b9;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .offline-auth-info {
            font-size: 13px;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .auth-code-display {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            word-break: break-all;
            font-size: 14px;
            text-align: center;
        }
        
        .btn-copy-auth {
            background-color: #9b59b6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn-copy-auth:hover {
            background-color: #8e44ad;
        }
        
        .auth-email-template {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border: 1px solid #f39c12;
            font-size: 12px;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            overflow-x: auto;
        }
        
        .auth-email-template h5 {
            color: #d68910;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        /* å…¶ä½™åŸæœ‰æ ·å¼ä¿æŒä¸å˜ */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }
        
        h1 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .method-selector {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #9b59b6;
        }
        
        .method-selector h3 {
            color: #8e44ad;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .method-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .method-tab {
            padding: 12px 24px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background-color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .method-tab.active {
            border-color: #3498db;
            background-color: #e3f2fd;
            color: #2980b9;
        }
        
        .method-tab:hover:not(.active) {
            border-color: #3498db;
            background-color: #f5f9ff;
        }
        
        .method-description {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }
        
        .method-description h3 {
            color: #2980b9;
            margin-top: 0;
        }
        
        .input-section, .result-section {
            margin-bottom: 30px;
        }
        
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #3498db;
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .algorithm-params {
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
            display: none;
        }
        
        .algorithm-params.active {
            display: block;
        }
        
        .params-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .param-item {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .param-item label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .param-value {
            font-weight: 700;
            color: #2c3e50;
            margin-top: 5px;
            font-size: 1.1rem;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 14px 28px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-calculate {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-calculate:hover {
            background-color: #27ae60;
        }
        
        .btn-calculate:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .btn-export {
            background-color: #3498db;
            color: white;
        }
        
        .btn-export:hover {
            background-color: #2980b9;
        }
        
        .btn-export:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .btn-export-pdf {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-export-pdf:hover {
            background-color: #c0392b;
        }
        
        .btn-export-pdf:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .btn-reset {
            background-color: #e74c3c;
            color: white;
        }
        
        .btn-reset:hover {
            background-color: #c0392b;
        }
        
        .btn-import {
            background-color: #9b59b6;
            color: white;
        }
        
        .btn-import:hover {
            background-color: #8e44ad;
        }
        
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        th {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
            padding: 15px;
            text-align: center;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
            text-align: center;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #ecf0f1;
        }
        
        .formula-display {
            background-color: #f1f8ff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #3498db;
        }
        
        .result-box {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed #ddd;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .result-value {
            font-weight: 700;
            color: #2980b9;
        }
        
        .highlight {
            background-color: #fffacd;
            font-weight: bold;
        }
        
        .red-highlight {
            background-color: #ffcccc !important;
            font-weight: bold;
            color: #c0392b;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #7f8c8d;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        
        .instructions {
            background-color: #fff8e1;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-size: 0.95rem;
        }
        
        .instructions h4 {
            margin-top: 0;
            color: #f39c12;
        }
        
        .package-results {
            margin-top: 30px;
        }
        
        .package-result-item {
            background-color: #f0f7ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .package-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .package-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .package-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .stat-item {
            background-color: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .full-score-bidders {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }
        
        .full-score-title {
            font-weight: 600;
            color: #27ae60;
            margin-bottom: 10px;
        }
        
        .full-score-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .full-score-bidder {
            background-color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .summary-section {
            background-color: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .summary-table th {
            background-color: #34495e;
        }
        
        .summary-table td {
            padding: 12px;
        }
        
        .bidder-fullscore-count {
            background-color: #fff8e1;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .package-stats {
                grid-template-columns: 1fr;
            }
            
            .method-tabs {
                flex-direction: column;
            }
            
            .params-grid {
                grid-template-columns: 1fr;
            }
            
            .developer-tag, .usage-counter {
                position: relative;
                top: auto;
                left: auto;
                right: auto;
                margin-bottom: 10px;
                text-align: center;
            }
            
            .toolbox-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .file-input-container {
            position: relative;
            margin: 20px 0;
            height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
        }
        
        .file-input-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px;
            background-color: #f8f9fa;
            border: 2px dashed #3498db;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            height: 100%;
            box-sizing: border-box;
        }
        
        .file-input-label:hover {
            border-color: #2980b9;
            background-color: #f0f7ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .file-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .import-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #9b59b6;
        }
        
        .import-section h3 {
            margin-top: 0;
            color: #8e44ad;
            margin-bottom: 15px;
        }
        
        .file-icon {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .score-100 {
            background-color: #d4edda !important;
            color: #155724;
            font-weight: bold;
        }
        
        .score-high {
            background-color: #d1ecf1 !important;
            color: #0c5460;
        }
        
        .score-medium {
            background-color: #fff3cd !important;
            color: #856404;
        }
        
        .score-low {
            background-color: #f8d7da !important;
            color: #721c24;
        }
        
        .score-0 {
            background-color: #f5f5f5 !important;
            color: #6c757d;
        }
        
        .package-divider {
            background-color: #e3f2fd;
            font-weight: bold;
            color: #1565c0;
            text-align: center;
        }
        
        .pdf-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 1.5rem;
            flex-direction: column;
        }
        
        .pdf-loading.hidden {
            display: none;
        }
        
        .pdf-loading.active {
            display: flex;
        }
        
        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3498db;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .pdf-export-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        
        .pdf-export-section h3 {
            color: #c0392b;
            margin-top: 0;
        }
        
        .pdf-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .pdf-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pdf-option input[type="checkbox"] {
            width: auto;
        }
        
        .hidden-pdf-container {
            position: absolute;
            left: -9999px;
            top: 0;
            width: 1100px;
            background-color: white;
            font-family: 'Microsoft YaHei', sans-serif;
            z-index: -1;
            visibility: hidden;
        }
        
        .pdf-cover {
            width: 1100px;
            height: 800px;
            padding: 40px;
            background-color: #f5f7fa;
            box-sizing: border-box;
        }
        
        .algorithm-badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: #3498db;
            color: white;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 10px;
        }
        
        .btn-payment {
            background-color: #f39c12;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            font-weight: bold;
        }
        
        .btn-payment:hover {
            background-color: #d68910;
        }
        
        .emphasis {
            background-color: #fffacd;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .excel-structure-notice {
            color: #e74c3c !important;
            font-weight: bold !important;
            font-size: 1.1em !important;
            background-color: #ffe6e6 !important;
            padding: 8px 12px !important;
            border-radius: 4px !important;
            border-left: 4px solid #e74c3c !important;
            margin: 10px 0 !important;
            display: inline-block !important;
        }
        
        .excel-structure-notice mark {
            background-color: #ffcccc !important;
            color: #c0392b !important;
            font-weight: 900 !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
        }
        
        /* å¼€å‘è€…æ¶ˆæ¯å¼¹çª—æ ·å¼ */
        .dev-message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .dev-message-modal.active {
            display: flex;
        }
        
        .dev-message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            color: white;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease;
            position: relative;
            overflow: hidden;
        }
        
        .dev-message-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            animation: float 20s linear infinite;
            z-index: -1;
        }
        
        .dev-message-content h3 {
            margin-top: 0;
            font-size: 24px;
            margin-bottom: 20px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .dev-message-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .dev-message-close {
            background-color: white;
            color: #667eea;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .dev-message-close:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        
        .sparkle {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: white;
            border-radius: 50%;
            animation: sparkle 2s infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes float {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
    </style>
    <!-- å¤–éƒ¨JavaScriptåº“ä¿æŒåŸæ · -->
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
    <!-- å¸¸ç”¨å·¥å…·ç®± -->
    <div class="toolbox-container">
        <div class="toolbox-title">å¸¸ç”¨å·¥å…·ç®±</div>
        <div class="toolbox-grid">
            <a href="https://www.ilovepdf.com/zh-cn" target="_blank" class="tool-item">
                <div class="tool-icon">ğŸ“„</div>
                <div class="tool-name">PDFå·¥å…·</div>
                <div class="tool-desc">PDFåˆå¹¶ã€åˆ†å‰²ã€è½¬æ¢ç­‰</div>
            </a>
            
            <div class="tool-item" id="wordToPPT">
                <div class="tool-icon">ğŸ“Š</div>
                <div class="tool-name">Wordè½¬PPT</div>
                <div class="tool-desc">ä¸Šä¼ Wordæ–‡æ¡£è‡ªåŠ¨è½¬æ¢ä¸ºPPT</div>
            </div>
            
            <div class="tool-item" id="pdfTextExtract">
                <div class="tool-icon">ğŸ“</div>
                <div class="tool-name">PDFæ–‡å­—æå–</div>
                <div class="tool-desc">æå–PDFæ–‡å­—ï¼Œä¿ç•™åŸæ ¼å¼</div>
            </div>
            
            <div class="tool-item" id="aiPhotoEdit">
                <div class="tool-icon">ğŸ–¼ï¸</div>
                <div class="tool-name">AI På›¾å·¥å…·</div>
                <div class="tool-desc">æ™ºèƒ½å›¾ç‰‡ç¼–è¾‘å¤„ç†</div>
            </div>
        </div>
    </div>

    <!-- å¼€å‘è€…æ¶ˆæ¯å¼¹çª— -->
    <div id="devMessageModal" class="dev-message-modal">
        <div class="dev-message-content">
            <h3>è‡´ä½¿ç”¨è€…</h3>
            <div class="dev-message-text">
                åˆ›ä½œå¦‚ç¢ç‰ï¼Œæ¯ä¸€ç¬”çš†æ˜¯å¿ƒè¡€å‡æˆã€‚<br>
                è‹¥æ‚¨æ„¿ä»¥ç‚¹æ»´æ”¯æŒï¼Œä¸ºè¿™ä»½åŒ å¿ƒæ·»è–ªï¼Œä¸èƒœæ„Ÿæ¿€ã€‚
            </div>
            <button class="dev-message-close" onclick="closeDevMessage()">å…³é—­</button>
        </div>
    </div>

    <!-- é‡æ–°è®¾è®¡çš„æ”¯ä»˜å¼¹çª— -->
    <div id="paymentModal" class="payment-modal">
        <div class="payment-content">
            <h2>æ”¯æŒå¼€å‘è€…ï¼Œå¢åŠ ä½¿ç”¨æ¬¡æ•°</h2>
            <div class="payment-subtitle">
                å…è´¹æ¬¡æ•°å·²ç”¨å®Œï¼Œè¯·é€‰æ‹©æ‰“èµé‡‘é¢å¢åŠ ä½¿ç”¨æ¬¡æ•°
            </div>
            
            <div class="payment-grid">
                <div class="payment-left">
                    <h3 style="color: #2c3e50; margin-top: 0; margin-bottom: 20px; font-size: 20px;">é€‰æ‹©æ‰“èµé‡‘é¢</h3>
                    
                    <div class="donation-options">
                        <div class="donation-option" data-amount="8" data-times="1" onclick="selectDonationOption(this)">
                            <div class="donation-amount">8å…ƒ</div>
                            <div class="donation-times">+1æ¬¡ä½¿ç”¨</div>
                            <div class="donation-description">å•æ¬¡ä½“éªŒ</div>
                        </div>
                        <div class="donation-option" data-amount="18" data-times="3" onclick="selectDonationOption(this)">
                            <div class="donation-amount">18å…ƒ</div>
                            <div class="donation-times">+3æ¬¡ä½¿ç”¨</div>
                            <div class="donation-description">ç»æµå®æƒ </div>
                        </div>
                        <div class="donation-option" data-amount="58" data-times="10" onclick="selectDonationOption(this)">
                            <div class="donation-amount">58å…ƒ</div>
                            <div class="donation-times">+10æ¬¡ä½¿ç”¨</div>
                            <div class="donation-description">æ‰¹é‡ä½¿ç”¨</div>
                        </div>
                        <div class="donation-option" data-amount="88" data-times="9999" onclick="selectDonationOption(this)">
                            <div class="donation-amount">88å…ƒ</div>
                            <div class="donation-times">ç»ˆç”Ÿä½¿ç”¨</div>
                            <div class="donation-description">å°Šè´µç”¨æˆ·</div>
                        </div>
                    </div>
                    
                    <div class="machine-code-section">
                        <h4>æœºå™¨ç ï¼ˆè¯·å°†æ­¤ç æä¾›ç»™å¼€å‘è€…ï¼‰</h4>
                        <div id="machineCodeDisplay" class="machine-code-display">æ­£åœ¨ç”Ÿæˆæœºå™¨ç ...</div>
                        <button class="btn-copy-machine" onclick="copyMachineCode()">å¤åˆ¶æœºå™¨ç </button>
                        <div class="contact-info">
                            <strong>æ”¯ä»˜åè¯·è”ç³»å¼€å‘è€…ï¼š</strong> 65496209@qq.com<br>
                            æä¾›æœºå™¨ç å’Œæ”¯ä»˜æˆªå›¾ä»¥è·å–æˆæƒ
                        </div>
                    </div>
                    
                    <div class="payment-qrcode">
                        <div style="font-weight: bold; color: #09bb07; margin-bottom: 10px;">å¾®ä¿¡æ‰«ç æ”¯ä»˜</div>
                        <!-- è¯·æ›¿æ¢ä¸ºæ‚¨çš„å¾®ä¿¡æ”¶æ¬¾ç  -->
                        <img src="https://i.ibb.co/rRGh4r9d/image.jpg" alt="å¾®ä¿¡æ”¶æ¬¾ç ">
                        <div style="margin-top: 10px; font-size: 14px; color: #7f8c8d;">è¯·æˆªå›¾ä¿å­˜æ”¯ä»˜æˆåŠŸé¡µé¢</div>
                    </div>
                </div>
                
                <div class="payment-right">
                    <h3 style="color: #2980b9; margin-top: 0; margin-bottom: 20px; font-size: 20px;">æˆæƒè¯´æ˜</h3>
                    
                    <div class="payment-instructions">
                        <ol>
                            <li>ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç æ”¯ä»˜å¯¹åº”é‡‘é¢</li>
                            <li><strong>åŠ¡å¿…æˆªå›¾ä¿å­˜æ”¯ä»˜æˆåŠŸé¡µé¢</strong></li>
                            <li>å¤åˆ¶æœºå™¨ç å’Œæ”¯ä»˜æˆªå›¾</li>
                            <li>ç‚¹å‡»"ç”Ÿæˆæˆæƒè¯·æ±‚ç "æŒ‰é’®</li>
                            <li>å°†æˆæƒè¯·æ±‚ç å’Œæ”¯ä»˜æˆªå›¾å‘é€åˆ°é‚®ç®±</li>
                            <li>å¼€å‘è€…æ”¶åˆ°åï¼Œä¼šå›å¤æˆæƒç ç»™æ‚¨</li>
                            <li>åœ¨å·¥å…·ä¸­ä½¿ç”¨"å¯¼å…¥æˆæƒç "åŠŸèƒ½æ¿€æ´»ä½¿ç”¨æƒé™</li>
                        </ol>
                    </div>
                    
                    <!-- ç¦»çº¿æˆæƒéªŒè¯æ–¹æ¡ˆ -->
                    <div class="offline-auth-section">
                        <h4>ğŸ“§ ç¦»çº¿æˆæƒéªŒè¯æ–¹æ¡ˆ</h4>
                        
                        <div id="authCodeDisplay" class="auth-code-display">è¯·å…ˆé€‰æ‹©æ‰“èµé‡‘é¢</div>
                        
                        <button class="btn-copy-auth" onclick="generateAuthRequestCode()" id="btnGenerateAuth" disabled>
                            ğŸ”‘ ç”Ÿæˆæˆæƒè¯·æ±‚ç 
                        </button>
                        
                        <button class="btn-copy-auth" onclick="copyAuthRequestCode()" id="btnCopyAuth" disabled style="background-color: #3498db;">
                            ğŸ“‹ å¤åˆ¶æˆæƒè¯·æ±‚ç 
                        </button>
                        
                        <button class="btn-copy-auth" onclick="showLicenseModal()" style="background-color: #2ecc71;">
                            âœ… å¯¼å…¥æˆæƒç 
                        </button>
                        
                        <div class="auth-email-template">
                            <h5>é‚®ä»¶æ¨¡æ¿ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰</h5>
ä¸»é¢˜ï¼šæŠ•æ ‡å·¥å…·æˆæƒè¯·æ±‚ - [æ‚¨çš„å§“å/å…¬å¸å]

æ­£æ–‡ï¼š
å¼€å‘è€…æ‚¨å¥½ï¼Œ

æˆ‘å·²æ”¯ä»˜[8/18/58/88]å…ƒè´­ä¹°æŠ•æ ‡ä»·æ ¼è¯„åˆ†ä¼°ç®—å·¥å…·çš„ä½¿ç”¨æƒé™ã€‚
æ”¯ä»˜æˆªå›¾å·²é™„åœ¨é‚®ä»¶ä¸­ã€‚

æˆ‘çš„æˆæƒè¯·æ±‚ç æ˜¯ï¼š
ã€è¯·åœ¨æ­¤å¤„ç²˜è´´æ‚¨çš„æˆæƒè¯·æ±‚ç ã€‘

è¯·æŸ¥æ”¶å¹¶å›å¤æˆæƒç ï¼Œè°¢è°¢ï¼

[æ‚¨çš„å§“å/å…¬å¸å]
[è”ç³»æ–¹å¼]
                        </div>
                    </div>
                    
                    <div class="payment-notice">
                        <p><strong>âš ï¸ é‡è¦æç¤ºï¼š</strong>æ¯ä¸ªæˆæƒç åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œè¯·å‹¿é‡å¤ä½¿ç”¨ï¼</p>
                    </div>
                </div>
            </div>
            
            <div class="payment-actions">
                <button class="btn-close-payment" onclick="closePaymentModal()">å…³é—­çª—å£</button>
            </div>
        </div>
    </div>
    
    <!-- æˆæƒç è¾“å…¥å¼¹çª— -->
    <div id="licenseModal" class="license-modal">
        <div class="license-content">
            <h2>æˆæƒç æ¿€æ´»</h2>
            <div class="license-subtitle">
                è¯·è¾“å…¥ä»å¼€å‘è€…å¤„è·å¾—çš„æˆæƒç ä»¥æ¿€æ´»ä½¿ç”¨æƒé™
            </div>
            
            <div class="license-instructions">
                <h4>æˆæƒç è·å–è¯´æ˜</h4>
                <ol>
                    <li>åœ¨æ”¯ä»˜å¼¹çª—ä¸­é€‰æ‹©æ‰“èµé‡‘é¢å¹¶ç‚¹å‡»"ç”Ÿæˆæˆæƒè¯·æ±‚ç "æŒ‰é’®</li>
                    <li>å¤åˆ¶æˆæƒè¯·æ±‚ç å’Œæ”¯ä»˜æˆªå›¾å‘é€åˆ°é‚®ç®±ï¼š<strong>65496209@qq.com</strong></li>
                    <li>å¼€å‘è€…æ”¶åˆ°åï¼Œä¼šå›å¤æˆæƒç ç»™æ‚¨</li>
                    <li>åœ¨æ­¤å¤„è¾“å…¥æ”¶åˆ°çš„æˆæƒç ï¼Œç‚¹å‡»"æ¿€æ´»æˆæƒ"æŒ‰é’®</li>
                    <li>æ¿€æ´»æˆåŠŸåï¼Œå°†è·å¾—å¯¹åº”çš„ä½¿ç”¨æ¬¡æ•°</li>
                </ol>
            </div>
            
            <div class="license-input-section">
                <label for="licenseCode">æˆæƒç ï¼š</label>
                <textarea id="licenseCode" placeholder="è¯·åœ¨æ­¤å¤„ç²˜è´´ä»å¼€å‘è€…å¤„è·å¾—çš„æˆæƒç ..."></textarea>
                <div style="font-size: 12px; color: #7f8c8d; margin-top: 5px;">
                    æˆæƒç æ ¼å¼ç¤ºä¾‹ï¼šAUTH-XXXX-XXXX-XXXX-XXXX
                </div>
            </div>
            
            <div id="licenseStatus" class="license-status"></div>
            
            <div class="license-actions">
                <button class="btn-activate" id="activateButton" onclick="activateLicense()">æ¿€æ´»æˆæƒ</button>
                <button class="btn-close-license" onclick="closeLicenseModal()">å…³é—­çª—å£</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- ä¿®æ”¹ï¼šä½¿ç”¨æ¬¡æ•°è®¡æ•°å™¨æ”¾åœ¨å·¦è¾¹ -->
        <div id="usageCounter" class="usage-counter" onclick="showPaymentModal()">
            <span>å‰©ä½™æ¬¡æ•°: <span id="remainingUses">3</span>æ¬¡</span>
        </div>
        
        <!-- ä¿®æ”¹ï¼šå¼€å‘è€…æ ‡è®°æ”¾åœ¨å³è¾¹ -->
        <div class="developer-tag" onclick="showDeveloperMessage()">2026Developer@sy</div>
        
        <div class="header">
            <h1>æŠ•æ ‡ä»·æ ¼è¯„åˆ†ä¼°ç®—å·¥å…·</h1>
            <p class="subtitle">æ”¯æŒå¤šç§ä»·æ ¼è¯„åˆ†ç®—æ³• | è‡ªåŠ¨è®¡ç®—å„åŒ…ä»·æ ¼è¯„å®¡å¾—åˆ†</p>
        </div>
        
        <div class="method-selector">
            <h3>é€‰æ‹©ä»·æ ¼è¯„åˆ†ç®—æ³•</h3>
            <div class="method-tabs">
                <div class="method-tab active" data-method="arithmetic" onclick="selectMethod('arithmetic')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                        <path d="M7.5 7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1H7V7.5a.5.5 0 0 1 .5-.5zm3 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1H10V7.5a.5.5 0 0 1 .5-.5z"/>
                    </svg>
                    ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•
                </div>
                <div class="method-tab" data-method="interval" onclick="selectMethod('interval')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
                    </svg>
                    åŒºé—´å¤åˆå¹³å‡ä»·æ³•
                </div>
            </div>
        </div>
        
        <!-- ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•å‚æ•° -->
        <div id="arithmeticParams" class="algorithm-params active">
            <h3>ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•å‚æ•°è®¾ç½®</h3>
            <div class="control-group">
                <label for="floatCoefficient">æµ®åŠ¨ç³»æ•° C (å•ä½ï¼š%)ï¼š</label>
                <select id="floatCoefficient">
                    <option value="-0.25">-0.25%</option>
                    <option value="-0.5">-0.5%</option>
                    <option value="-0.75">-0.75%</option>
                    <option value="-1.0">-1.0%</option>
                    <option value="-1.25">-1.25%</option>
                    <option value="-1.5">-1.5%</option>
                </select>
                <p style="margin-top: 5px; font-size: 0.9rem; color: #7f8c8d;">æ³¨ï¼šæµ®åŠ¨ç³»æ•°èŒƒå›´ä¸º-1.5% ~ -0.25%ï¼Œä»¥0.25%ä¸ºçº§å·®</p>
            </div>
            
            <div class="method-description">
                <h3>ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•è¯´æ˜</h3>
                <p>æ ¹æ®æ‹›æ ‡æ–‡ä»¶è§„å®šï¼Œå¯¼çº¿åˆ†æ ‡é‡‡ç”¨<strong>ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•</strong>è®¡ç®—ä»·æ ¼è¯„å®¡å¾—åˆ†ï¼š</p>
                <ol>
                    <li>è®¡ç®—M2æŠ•æ ‡äººï¼ˆé€šè¿‡æ‰€æœ‰åˆæ­¥è¯„å®¡çš„åˆæ ¼æŠ•æ ‡äººï¼‰è¯„æ ‡ä»·çš„å¹³å‡å€¼A1</li>
                    <li>æ’é™¤M2ä¸­ä½äºA1å€¼30%ï¼ˆä¸å«30%ï¼‰çš„æŠ¥ä»·ï¼Œå‰©ä½™M3ä¸ªæŠ•æ ‡äººå‚ä¸åŸºå‡†ä»·è®¡ç®—</li>
                    <li>è®¡ç®—M3ä¸ªæŠ•æ ‡äººè¯„æ ‡ä»·çš„å¹³å‡å€¼A2</li>
                    <li>è®¡ç®—åŸºå‡†ä»·A3 = A2 Ã— (1 + æµ®åŠ¨ç³»æ•°C)ï¼Œå…¶ä¸­CèŒƒå›´ä¸º-1.5% ~ -0.25%ï¼Œä»¥0.25%ä¸ºçº§å·®</li>
                    <li>ä»·æ ¼è¯„å®¡å¾—åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·</li>
                </ol>
                <div class="formula-display">
                    ä»·æ ¼è¯„å®¡å¾—åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·<br>
                    å½“æŠ•æ ‡ä»· â‰¥ åŸºå‡†ä»·ï¼Œn=2.0ï¼›å½“æŠ•æ ‡ä»· ï¼œ åŸºå‡†ä»·ï¼Œn=0
                </div>
            </div>
        </div>
        
        <!-- åŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•° -->
        <div id="intervalParams" class="algorithm-params">
            <h3>åŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•°è®¾ç½®</h3>
            <div class="params-grid">
                <div class="param-item">
                    <label>åŒºé—´ä¸‹é™ç³»æ•° b (%)</label>
                    <div class="param-value">-10%</div>
                    <input type="range" id="intervalLower" min="-20" max="0" step="1" value="-10">
                </div>
                <div class="param-item">
                    <label>åŒºé—´ä¸Šé™ç³»æ•° c (%)</label>
                    <div class="param-value">+10%</div>
                    <input type="range" id="intervalUpper" min="0" max="20" step="1" value="10">
                </div>
                <div class="param-item">
                    <label>è¯„æ ‡ä»· â‰¥ åŸºå‡†ä»·æ—¶çš„ç³»æ•° n1</label>
                    <div class="param-value">2.0</div>
                    <input type="range" id="n1" min="1.0" max="3.0" step="0.1" value="2.0">
                </div>
                <div class="param-item">
                    <label>è¯„æ ‡ä»· < åŸºå‡†ä»·æ—¶çš„ç³»æ•° n2</label>
                    <div class="param-value">1.0</div>
                    <input type="range" id="n2" min="0" max="2.0" step="0.1" value="1.0">
                </div>
            </div>
            
            <div class="method-description">
                <h3>åŒºé—´å¤åˆå¹³å‡ä»·æ³•è¯´æ˜</h3>
                <p>æ ¹æ®<strong>åŒºé—´å¤åˆå¹³å‡ä»·æ³•</strong>è®¡ç®—ä»·æ ¼è¯„å®¡å¾—åˆ†ï¼š</p>
                <ol>
                    <li>è®¡ç®—è¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººï¼ˆMä¸ªï¼‰è¯„æ ‡ä»·ç®—æœ¯å¹³å‡å€¼ A1</li>
                    <li>åˆ¤å®šMä¸ªè¯„æ ‡ä»·æ˜¯å¦å‡åœ¨å¹³å‡å€¼åŒºé—´[A1Ã—(1+b), A1Ã—(1+c)]èŒƒå›´å¤–</li>
                    <li>å¦‚æœå‡åœ¨èŒƒå›´å¤–ï¼Œåˆ™è®¡ç®—æ‰€æœ‰è¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººè¯„æ ‡ä»·çš„ç®—æœ¯å¹³å‡å€¼ä¸æ‰€æœ‰è¯„æ ‡ä»·æœ€å°å€¼ä¸¤è€…çš„å¹³å‡å€¼ï¼Œä¸ºåŸºå‡†ä»·</li>
                    <li>å¦‚æœå­˜åœ¨è¯„æ ‡ä»·åœ¨åŒºé—´èŒƒå›´å†…ï¼Œåˆ™è®¡ç®—åŒºé—´å†…çš„æŠ•æ ‡äººï¼ˆNä¸ªï¼‰è¯„æ ‡ä»·ç®—æœ¯å¹³å‡å€¼ï¼Œä¸ºåŸºå‡†ä»·</li>
                    <li>è®¡ç®—ä»·æ ¼åˆ†ï¼šä»·æ ¼åˆ†=100-100Ã—nÃ—|æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»·-åŸºå‡†ä»·|/åŸºå‡†ä»·</li>
                    <li>åˆ¤æ–­ä»·æ ¼åˆ†æ˜¯å¦å°äº0ï¼Œå¦‚æœå°äº0ï¼Œåˆ™ä»·æ ¼åˆ†ä¸º0</li>
                </ol>
                <div class="formula-display">
                    ä»·æ ¼åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·<br>
                    å½“è¯„æ ‡ä»· â‰¥ åŸºå‡†ä»·ï¼Œn=n1ï¼›å½“è¯„æ ‡ä»· < åŸºå‡†ä»·ï¼Œn=n2
                </div>
            </div>
        </div>
        
        <div class="input-section">
            <h2>æŠ•æ ‡æ•°æ®è¾“å…¥</h2>
            
            <div class="import-section">
                <h3>å¯¼å…¥Excelæ•°æ®</h3>
                <div class="instructions">
                    <h4>ä½¿ç”¨è¯´æ˜ï¼š</h4>
                    <p>1. ä½¿ç”¨ä¸‹æ–¹æŒ‰é’®å¯¼å…¥Excelæ–‡ä»¶ï¼Œæˆ–ç›´æ¥åœ¨ä¸‹æ–¹è¡¨æ ¼ä¸­æ‰‹åŠ¨è¾“å…¥æ•°æ®</p>
                    <p class="excel-structure-notice">2. Excelæ–‡ä»¶ç»“æ„éœ€åŒ…å«<mark>åŒ…å·(Eåˆ—)</mark>ã€<mark>åŒºåŸŸ(Gåˆ—)</mark>ã€<mark>æŠ•æ ‡äººåç§°(Håˆ—)</mark>ã€<mark>è¯„æ ‡æ€»ä»·(Jåˆ—)</mark>ç­‰åˆ—</p>
                    <p>3. é€‰æ‹©ç®—æ³•å¹¶è®¾ç½®ç›¸åº”å‚æ•°</p>
                    <p>4. ç‚¹å‡»"è®¡ç®—å„åŒ…ä»·æ ¼å¾—åˆ†"æŒ‰é’®ï¼Œç³»ç»Ÿå°†æŒ‰åŒ…è‡ªåŠ¨è®¡ç®—å¹¶æ˜¾ç¤ºç»“æœ</p>
                    <p>5. ç‚¹å‡»"å¯¼å‡ºæ±‡æ€»æŠ¥è¡¨"æˆ–"è¾“å‡ºPDF"æŒ‰é’®ï¼Œå¯å°†ç»“æœä¿å­˜ä¸ºæ–‡ä»¶</p>
                </div>
                
                <div class="file-input-container">
                    <div class="file-input-label">
                        <div class="file-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z"/>
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                            </svg>
                        </div>
                        <strong>ç‚¹å‡»é€‰æ‹©Excelæ–‡ä»¶å¯¼å…¥æ•°æ®</strong><br>
                        <span style="font-size: 0.9rem; color: #7f8c8d;">æ”¯æŒ.xlsx, .xlsæ ¼å¼</span>
                    </div>
                    <input type="file" id="excelFile" class="file-input" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
                </div>
                
                <div id="fileInfo" class="file-info"></div>
            </div>
            
            <h3>æŠ•æ ‡äººæ•°æ®</h3>
            <div class="table-container">
                <table id="bidTable">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>åŒ…å·</th>
                            <th>åŒºåŸŸ</th>
                            <th>æŠ•æ ‡äººåç§°</th>
                            <th>è¯„æ ‡æ€»ä»·ï¼ˆä¸‡å…ƒï¼‰</th>
                            <th>é€šè¿‡åˆæ­¥è¯„å®¡</th>
                            <th>æ˜¯å¦å‚ä¸åŸºå‡†ä»·è®¡ç®—</th>
                            <th>ä»·æ ¼å¾—åˆ†</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="bidTableBody">
                        <!-- åˆå§‹ä¸ºç©ºï¼Œé€šè¿‡å¯¼å…¥æ•°æ®æˆ–æ‰‹åŠ¨æ·»åŠ  -->
                    </tbody>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="addRow()" style="background-color: #9b59b6; color: white;">+ æ·»åŠ æŠ•æ ‡äºº</button>
            </div>
        </div>
        
        <div class="button-group">
            <button id="calculateBtn" class="btn-calculate" onclick="checkUsageAndCalculate()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                    <path d="M7.5 7a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1H7V7.5a.5.5 0 0 1 .5-.5zm3 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1H10V7.5a.5.5 0 0 1 .5-.5z"/>
                </svg>
                è®¡ç®—å„åŒ…ä»·æ ¼å¾—åˆ†
            </button>
            <button id="exportBtn" class="btn-export" onclick="checkUsageAndExport()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z"/>
                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                </svg>
                å¯¼å‡ºæ±‡æ€»æŠ¥è¡¨(Excel)
            </button>
            <button id="pdfBtn" class="btn-export-pdf" onclick="checkUsageAndPDF()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293V6.5z"/>
                    <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2zM9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5v2z"/>
                </svg>
                è¾“å‡ºPDFæŠ¥å‘Š
            </button>
            <button class="btn-reset" onclick="resetForm()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
                    <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
                </svg>
                é‡ç½®æ•°æ®
            </button>
            <button class="btn-payment" onclick="showPaymentModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v1H0V4zm0 3v5a2 2 0 0 0 2 2h12a2 2 0 0 0 2 2V7H0zm3 2h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1v-1a1 1 0 0 1 1-1z"/>
                </svg>
                è§£é”æ— é™ä½¿ç”¨
            </button>
            <button class="btn-import" onclick="showLicenseModal()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                </svg>
                å¯¼å…¥æˆæƒç 
            </button>
        </div>
        
        <div class="pdf-export-section">
            <h3>PDFå¯¼å‡ºé€‰é¡¹</h3>
            <div class="pdf-options">
                <div class="pdf-option">
                    <input type="checkbox" id="includeSummary" checked>
                    <label for="includeSummary">åŒ…å«æ±‡æ€»æŠ¥è¡¨</label>
                </div>
                <div class="pdf-option">
                    <input type="checkbox" id="includePackageDetails" checked>
                    <label for="includePackageDetails">åŒ…å«å„åŒ…è¯¦ç»†ç»“æœ</label>
                </div>
                <div class="pdf-option">
                    <input type="checkbox" id="includeAllBidders" checked>
                    <label for="includeAllBidders">åŒ…å«æ‰€æœ‰æŠ•æ ‡äººæ˜ç»†</label>
                </div>
            </div>
        </div>
        
        <div class="result-section">
            <h2>è®¡ç®—ç»“æœ <span id="algorithmBadge" class="algorithm-badge">ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•</span></h2>
            
            <div id="packageResultsContainer">
                <!-- å„åŒ…è®¡ç®—ç»“æœå°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
            </div>
            
            <div class="summary-section">
                <h3>æ±‡æ€»æŠ¥è¡¨</h3>
                <div id="summaryContainer">
                    <!-- æ±‡æ€»æŠ¥è¡¨å°†åŠ¨æ€ç”Ÿæˆåœ¨è¿™é‡Œ -->
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>æŠ•æ ‡ä»·æ ¼è¯„åˆ†ä¼°ç®—å·¥å…· v3.0 | æ”¯æŒç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•å’ŒåŒºé—´å¤åˆå¹³å‡ä»·æ³• | æ”¯æŒå¤šåŒ…è®¡ç®—</p>
            <p>è¯´æ˜ï¼šæœ¬å·¥å…·è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå®é™…è¯„å®¡ç»“æœä»¥æ‹›æ ‡å§”å‘˜ä¼šæœ€ç»ˆç¡®è®¤ä¸ºå‡†</p>
            <p>å¼€å‘è€…ï¼š2026Developer@sy | åŒä¸€å°ç”µè„‘å…è´¹ä½¿ç”¨3æ¬¡ï¼Œæ”¯æŒæ‰“èµå¢åŠ ä½¿ç”¨æ¬¡æ•°</p>
            <p>æ”¯ä»˜é—®é¢˜è¯·è”ç³»é‚®ç®±ï¼š65496209@qq.com</p>
        </div>
    </div>

    <!-- PDFç”ŸæˆåŠ è½½æç¤º -->
    <div id="pdfLoading" class="pdf-loading hidden">
        <div class="spinner"></div>
        <div>æ­£åœ¨ç”ŸæˆPDFæŠ¥å‘Šï¼Œè¯·ç¨å€™...</div>
        <div id="pdfProgress" style="margin-top: 10px; font-size: 1rem;"></div>
    </div>

    <!-- éšè—çš„PDFå®¹å™¨ -->
    <div id="pdfTempContainer" class="hidden-pdf-container"></div>

    <script>
// ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥ç³»ç»Ÿ
function checkForUpdates() {
    const currentVersion = document.querySelector('meta[name="version"]').content;
    const updateCheckUrl = document.querySelector('meta[name="update-check-url"]').content;
    
    // ä»localStorageè·å–ä¸Šæ¬¡æ£€æŸ¥æ—¶é—´
    const lastCheck = localStorage.getItem('lastUpdateCheck');
    const now = new Date().getTime();
    
    // å¦‚æœ24å°æ—¶å†…æ£€æŸ¥è¿‡ï¼Œä¸å†æ£€æŸ¥
    if (lastCheck && (now - parseInt(lastCheck)) < 24 * 60 * 60 * 1000) {
        return;
    }
    
    // ä¿å­˜æœ¬æ¬¡æ£€æŸ¥æ—¶é—´
    localStorage.setItem('lastUpdateCheck', now.toString());
    
    // è·å–æœ€æ–°ç‰ˆæœ¬ä¿¡æ¯
    fetch(updateCheckUrl + '?t=' + now)
        .then(response => response.json())
        .then(data => {
            if (data.version !== currentVersion) {
                showUpdateNotification(data);
            }
        })
        .catch(error => {
            console.log('ç‰ˆæœ¬æ£€æŸ¥å¤±è´¥:', error);
        });
}

// æ˜¾ç¤ºæ›´æ–°é€šçŸ¥
function showUpdateNotification(updateInfo) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        z-index: 10000;
        max-width: 400px;
        animation: slideIn 0.5s ease;
    `;
    
    notification.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
            <strong style="font-size: 16px;">ğŸ‰ å‘ç°æ–°ç‰ˆæœ¬ v${updateInfo.version}</strong>
            <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; color: white; cursor: pointer; font-size: 18px;">Ã—</button>
        </div>
        <div style="font-size: 14px; margin-bottom: 15px; line-height: 1.4;">
            <div>å‘å¸ƒæ—¥æœŸ: ${updateInfo.release_date}</div>
            <div style="margin-top: 5px;">æ›´æ–°å†…å®¹:</div>
            <ul style="margin: 5px 0 0 15px; padding: 0;">
                ${updateInfo.changelog.map(item => `<li style="margin-bottom: 3px;">${item}</li>`).join('')}
            </ul>
        </div>
        <div style="display: flex; gap: 10px;">
            <button onclick="updateNow('${updateInfo.update_url}')" style="background: white; color: #667eea; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-weight: bold; flex: 1;">
                ç«‹å³æ›´æ–°
            </button>
            <button onclick="remindLater()" style="background: rgba(255,255,255,0.2); color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; flex: 1;">
                ç¨åæé†’
            </button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // æ·»åŠ åŠ¨ç”»
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    `;
    document.head.appendChild(style);
    
    // å¦‚æœæ˜¯å¼ºåˆ¶æ›´æ–°ï¼Œä¸èƒ½å…³é—­
    if (updateInfo.force_update) {
        notification.querySelector('button').style.display = 'none';
        setTimeout(() => {
            updateNow(updateInfo.update_url);
        }, 5000);
    }
}

// ç«‹å³æ›´æ–°
function updateNow(url) {
    if (confirm('ç¡®å®šè¦æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬å—ï¼Ÿå½“å‰é¡µé¢æ•°æ®å°†è¢«åˆ·æ–°ã€‚')) {
        // ä¿å­˜å½“å‰æ•°æ®åˆ°sessionStorage
        const currentData = {
            tableData: getCurrentTableData(),
            algorithm: calculationResults.currentAlgorithm,
            params: getCurrentParams()
        };
        sessionStorage.setItem('pendingUpdateData', JSON.stringify(currentData));
        sessionStorage.setItem('pendingUpdateUrl', url);
        
        // è·³è½¬åˆ°æ–°ç‰ˆæœ¬
        window.location.href = url;
    }
}

// ç¨åæé†’ï¼ˆ24å°æ—¶åï¼‰
function remindLater() {
    localStorage.setItem('lastUpdateCheck', '0'); // é‡ç½®æ£€æŸ¥æ—¶é—´
    document.querySelector('div[style*="position: fixed"][style*="top: 20px"]').remove();
}

// è·å–å½“å‰è¡¨æ ¼æ•°æ®
function getCurrentTableData() {
    const rows = document.querySelectorAll('#bidTableBody tr');
    const data = [];
    rows.forEach(row => {
        data.push({
            package: row.querySelector('.package').value,
            region: row.querySelector('.region').value,
            name: row.querySelector('.bidder-name').value,
            price: row.querySelector('.bid-price').value,
            qualified: row.querySelector('.qualified').value
        });
    });
    return data;
}

// è·å–å½“å‰å‚æ•°
function getCurrentParams() {
    const algorithm = calculationResults.currentAlgorithm;
    if (algorithm === 'arithmetic') {
        return {
            algorithm: 'arithmetic',
            floatCoefficient: document.getElementById('floatCoefficient').value
        };
    } else {
        return {
            algorithm: 'interval',
            intervalLower: document.getElementById('intervalLower').value,
            intervalUpper: document.getElementById('intervalUpper').value,
            n1: document.getElementById('n1').value,
            n2: document.getElementById('n2').value
        };
    }
}

// é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ›´æ–°
document.addEventListener('DOMContentLoaded', function() {
    // ç­‰å¾…2ç§’åæ£€æŸ¥æ›´æ–°
    setTimeout(checkForUpdates, 2000);
    
    // æ£€æŸ¥æ˜¯å¦æœ‰å¾…æ¢å¤çš„æ•°æ®ï¼ˆä»æ—§ç‰ˆæœ¬æ›´æ–°è¿‡æ¥ï¼‰
    const pendingUpdateData = sessionStorage.getItem('pendingUpdateData');
    const pendingUpdateUrl = sessionStorage.getItem('pendingUpdateUrl');
    
    if (pendingUpdateData && pendingUpdateUrl && pendingUpdateUrl === window.location.href) {
        try {
            const data = JSON.parse(pendingUpdateData);
            restoreData(data);
            alert('æ•°æ®å·²ä»ä¸Šä¸€ç‰ˆæœ¬æ¢å¤ï¼');
        } catch (e) {
            console.error('æ¢å¤æ•°æ®å¤±è´¥:', e);
        }
        // æ¸…é™¤ä¸´æ—¶å­˜å‚¨
        sessionStorage.removeItem('pendingUpdateData');
        sessionStorage.removeItem('pendingUpdateUrl');
    }
});

// æ¢å¤æ•°æ®
function restoreData(data) {
    if (data.tableData && data.tableData.length > 0) {
        // æ¸…ç©ºç°æœ‰è¡¨æ ¼
        const tableBody = document.getElementById('bidTableBody');
        tableBody.innerHTML = '';
        
        // æ¢å¤è¡¨æ ¼æ•°æ®
        data.tableData.forEach((rowData, index) => {
            addRow();
            const rows = tableBody.querySelectorAll('tr');
            const currentRow = rows[rows.length - 1];
            
            currentRow.querySelector('.package').value = rowData.package || '';
            currentRow.querySelector('.region').value = rowData.region || '';
            currentRow.querySelector('.bidder-name').value = rowData.name || '';
            currentRow.querySelector('.bid-price').value = rowData.price || '0';
            currentRow.querySelector('.qualified').value = rowData.qualified || 'yes';
        });
        
        updateRowNumbers();
    }
    
    // æ¢å¤ç®—æ³•è®¾ç½®
    if (data.algorithm) {
        selectMethod(data.algorithm);
        if (data.params) {
            if (data.algorithm === 'arithmetic') {
                document.getElementById('floatCoefficient').value = data.params.floatCoefficient || '-0.25';
            } else {
                document.getElementById('intervalLower').value = data.params.intervalLower || '-10';
                document.getElementById('intervalUpper').value = data.params.intervalUpper || '10';
                document.getElementById('n1').value = data.params.n1 || '2.0';
                document.getElementById('n2').value = data.params.n2 || '1.0';
                updateIntervalParamsDisplay();
            }
        }
    }
}
        // å…¨å±€å˜é‡å­˜å‚¨è®¡ç®—ç»“æœå’Œæ–‡ä»¶å
        let calculationResults = {
            packages: {}, // æŒ‰åŒ…å­˜å‚¨è®¡ç®—ç»“æœ
            allBidders: [], // æ‰€æœ‰æŠ•æ ‡äººæ•°æ®
            bidderFullScoreStats: {}, // æŠ•æ ‡äººæ»¡åˆ†åŒ…ç»Ÿè®¡
            currentAlgorithm: 'arithmetic' // å½“å‰é€‰æ‹©çš„ç®—æ³•
        };
        let currentFileName = ''; // å­˜å‚¨å½“å‰å¯¼å…¥çš„Excelæ–‡ä»¶å
        
        // ä½¿ç”¨æ¬¡æ•°ç®¡ç†
        let usageData = {
            remainingUses: 3, // å‰©ä½™ä½¿ç”¨æ¬¡æ•°
            isUnlimited: false, // æ˜¯å¦å·²è§£é”æ— é™ä½¿ç”¨
            computerId: null, // ç”µè„‘æ ‡è¯†
            lastPaymentDate: null // æœ€åæ”¯ä»˜æ—¥æœŸ
        };
        
        // æˆæƒç›¸å…³å˜é‡
        let authRequestCode = null; // æˆæƒè¯·æ±‚ç 
        let selectedDonation = {
            amount: 0,
            times: 0
        };
        
        // é”®ç›˜è¾“å…¥æ£€æµ‹
        let keySequence = '';
        let lastKeyTime = 0;
        
        // ç”Ÿæˆç”µè„‘å”¯ä¸€æ ‡è¯†
        function generateComputerId() {
            // ä½¿ç”¨æµè§ˆå™¨æŒ‡çº¹ä½œä¸ºç”µè„‘æ ‡è¯†
            const navigatorInfo = JSON.stringify({
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                hardwareConcurrency: navigator.hardwareConcurrency,
                deviceMemory: navigator.deviceMemory
            });
            
            // ç®€å•å“ˆå¸Œå‡½æ•°
            let hash = 0;
            for (let i = 0; i < navigatorInfo.length; i++) {
                const char = navigatorInfo.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // è½¬æ¢ä¸º32ä½æ•´æ•°
            }
            
            return 'computer_' + Math.abs(hash).toString(16);
        }
        
        // åˆå§‹åŒ–ä½¿ç”¨æ¬¡æ•°
        function initUsage() {
            // ç”Ÿæˆç”µè„‘ID
            usageData.computerId = generateComputerId();
            
            // å°è¯•ä»localStorageåŠ è½½ç”¨æˆ·æ•°æ®
            const savedUsers = localStorage.getItem('bidToolUsers');
            if (savedUsers) {
                try {
                    const users = JSON.parse(savedUsers);
                    
                    // æŸ¥æ‰¾å½“å‰ç”µè„‘çš„ç”¨æˆ·æ•°æ®
                    const userData = users.find(user => user.machineCode === usageData.computerId);
                    
                    if (userData) {
                        // æ‰¾åˆ°ç”¨æˆ·æ•°æ®ï¼Œä½¿ç”¨ç®¡ç†å·¥å…·ä¸­çš„æ•°æ®
                        usageData.remainingUses = userData.remainingUses;
                        usageData.isUnlimited = userData.isUnlimited;
                        usageData.lastPaymentDate = userData.lastPayment;
                    } else {
                        // æ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æ•°æ®ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ—§çš„æœ¬åœ°æ•°æ®
                        const savedUsageData = localStorage.getItem('bidCalculatorUsage');
                        if (savedUsageData) {
                            try {
                                const parsedData = JSON.parse(savedUsageData);
                                // æ£€æŸ¥æ˜¯å¦æ˜¯åŒä¸€å°ç”µè„‘
                                if (parsedData.computerId === usageData.computerId) {
                                    usageData = parsedData;
                                }
                            } catch (e) {
                                console.error('åŠ è½½æ—§æ•°æ®å¤±è´¥:', e);
                            }
                        }
                        
                        // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç”¨æˆ·æ•°æ®ï¼Œåˆ›å»ºæ–°ç”¨æˆ·è®°å½•
                        const newUser = {
                            id: Date.now(),
                            machineCode: usageData.computerId,
                            email: '',
                            remainingUses: usageData.remainingUses,
                            isUnlimited: usageData.isUnlimited,
                            lastPayment: usageData.lastPaymentDate,
                            totalPayments: 0
                        };
                        
                        users.push(newUser);
                        localStorage.setItem('bidToolUsers', JSON.stringify(users));
                    }
                } catch (e) {
                    console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', e);
                }
            } else {
                // æ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼Œåˆ›å»ºæ–°çš„ç”¨æˆ·åˆ—è¡¨
                const newUser = {
                    id: Date.now(),
                    machineCode: usageData.computerId,
                    email: '',
                    remainingUses: 3,
                    isUnlimited: false,
                    lastPayment: null,
                    totalPayments: 0
                };
                
                localStorage.setItem('bidToolUsers', JSON.stringify([newUser]));
            }
            
            // æ›´æ–°æ˜¾ç¤º
            updateUsageDisplay();
            
            // æ£€æŸ¥æŒ‰é’®çŠ¶æ€
            updateButtonStates();
        }
        
        // ä¿å­˜ä½¿ç”¨æ•°æ®åˆ°ç®¡ç†å·¥å…·çš„ç”¨æˆ·æ•°æ®ä¸­
        function saveUsageData() {
            // è¯»å–ç°æœ‰ç”¨æˆ·æ•°æ®
            const savedUsers = localStorage.getItem('bidToolUsers');
            let users = [];
            if (savedUsers) {
                try {
                    users = JSON.parse(savedUsers);
                } catch (e) {
                    console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', e);
                }
            }
            
            // æŸ¥æ‰¾å½“å‰æœºå™¨ç çš„ç”¨æˆ·ç´¢å¼•
            const userIndex = users.findIndex(user => user.machineCode === usageData.computerId);
            
            if (userIndex >= 0) {
                // æ›´æ–°ç”¨æˆ·æ•°æ®
                users[userIndex].remainingUses = usageData.remainingUses;
                users[userIndex].isUnlimited = usageData.isUnlimited;
                users[userIndex].lastPayment = usageData.lastPaymentDate;
            } else {
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åˆ›å»ºæ–°ç”¨æˆ·
                const newUser = {
                    id: Date.now(),
                    machineCode: usageData.computerId,
                    email: '',
                    remainingUses: usageData.remainingUses,
                    isUnlimited: usageData.isUnlimited,
                    lastPayment: usageData.lastPaymentDate,
                    totalPayments: 0
                };
                users.push(newUser);
            }
            
            // ä¿å­˜å›localStorage
            localStorage.setItem('bidToolUsers', JSON.stringify(users));
        }
        
        // æ›´æ–°ä½¿ç”¨æ¬¡æ•°æ˜¾ç¤º
        function updateUsageDisplay() {
            const usageCounter = document.getElementById('usageCounter');
            const remainingUsesSpan = document.getElementById('remainingUses');
            
            if (usageData.isUnlimited) {
                usageCounter.classList.add('free');
                remainingUsesSpan.textContent = 'æ— é™';
                usageCounter.innerHTML = '<span>å‰©ä½™æ¬¡æ•°: <span id="remainingUses">æ— é™</span></span>';
            } else {
                usageCounter.classList.remove('free');
                remainingUsesSpan.textContent = usageData.remainingUses;
                usageCounter.innerHTML = '<span>å‰©ä½™æ¬¡æ•°: <span id="remainingUses">' + usageData.remainingUses + '</span>æ¬¡</span>';
            }
        }
        
        // æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°
        function checkUsage() {
            if (usageData.isUnlimited) {
                return true; // å·²è§£é”æ— é™ä½¿ç”¨
            }
            
            if (usageData.remainingUses > 0) {
                return true; // è¿˜æœ‰å‰©ä½™æ¬¡æ•°
            }
            
            return false; // æ¬¡æ•°å·²ç”¨å®Œ
        }
        
        // ä½¿ç”¨ä¸€æ¬¡åŠŸèƒ½
        function useOnce() {
            if (usageData.isUnlimited) {
                return true; // å·²è§£é”æ— é™ä½¿ç”¨ï¼Œä¸æ¶ˆè€—æ¬¡æ•°
            }
            
            if (usageData.remainingUses > 0) {
                usageData.remainingUses--;
                saveUsageData(); // ä¿å­˜åˆ°ç®¡ç†å·¥å…·çš„ç”¨æˆ·æ•°æ®
                updateUsageDisplay();
                updateButtonStates();
                return true;
            }
            
            return false; // æ¬¡æ•°å·²ç”¨å®Œ
        }
        
        // å¢åŠ ä½¿ç”¨æ¬¡æ•°
        function addUsageTimes(times) {
            if (usageData.isUnlimited) {
                return; // å·²ç»æ˜¯æ— é™ä½¿ç”¨
            }
            
            if (times === 9999) {
                // ç»ˆç”Ÿå°Šè´µç”¨æˆ·
                usageData.isUnlimited = true;
                usageData.lastPaymentDate = new Date().toISOString();
            } else {
                usageData.remainingUses += times;
                usageData.lastPaymentDate = new Date().toISOString();
            }
            
            saveUsageData(); // ä¿å­˜åˆ°ç®¡ç†å·¥å…·çš„ç”¨æˆ·æ•°æ®
            updateUsageDisplay();
            updateButtonStates();
            
            // å¦‚æœé€šè¿‡é”®ç›˜è¾“å…¥88888888å¢åŠ æ¬¡æ•°ï¼Œä¸æ˜¾ç¤ºæç¤º
            if (times !== 8 || keySequence !== '88888888') {
                alert(`ä½¿ç”¨æ¬¡æ•°å·²å¢åŠ ${times}æ¬¡ï¼å½“å‰å‰©ä½™æ¬¡æ•°ï¼š${usageData.remainingUses}`);
            }
        }
        
        // é‡ç½®ä½¿ç”¨æ¬¡æ•°åˆ°å…è´¹3æ¬¡ï¼ˆå¼€å‘è€…åŠŸèƒ½ï¼‰
        function resetUsageToFree() {
            // é‡ç½®ä½¿ç”¨æ¬¡æ•°åˆ°3æ¬¡
            usageData.remainingUses = 3;
            usageData.isUnlimited = false;
            usageData.lastPaymentDate = null;
            
            saveUsageData();
            updateUsageDisplay();
            updateButtonStates();
        }
        
        // æ˜¾ç¤ºå¼€å‘è€…æ¶ˆæ¯
        function showDeveloperMessage() {
            const modal = document.getElementById('devMessageModal');
            modal.classList.add('active');
            
            // åˆ›å»ºé—ªçƒæ•ˆæœ
            createSparkles();
        }
        
        // åˆ›å»ºé—ªçƒæ•ˆæœ
        function createSparkles() {
            const modal = document.getElementById('devMessageModal');
            const content = modal.querySelector('.dev-message-content');
            
            // æ¸…é™¤ä¹‹å‰çš„é—ªçƒ
            const existingSparkles = modal.querySelectorAll('.sparkle');
            existingSparkles.forEach(sparkle => sparkle.remove());
            
            // åˆ›å»ºæ–°çš„é—ªçƒ
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = `${Math.random() * 100}%`;
                sparkle.style.top = `${Math.random() * 100}%`;
                sparkle.style.animationDelay = `${Math.random() * 2}s`;
                sparkle.style.animationDuration = `${1 + Math.random() * 2}s`;
                content.appendChild(sparkle);
            }
        }
        
        // å…³é—­å¼€å‘è€…æ¶ˆæ¯
        function closeDevMessage() {
            const modal = document.getElementById('devMessageModal');
            modal.classList.remove('active');
        }
        
        // æ˜¾ç¤ºæ”¯ä»˜å¼¹çª—
        function showPaymentModal() {
            // é‡ç½®é€‰æ‹©
            selectedDonation = { amount: 0, times: 0 };
            document.querySelectorAll('.donation-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // é‡ç½®æŒ‰é’®çŠ¶æ€
            document.getElementById('btnGenerateAuth').disabled = true;
            document.getElementById('btnCopyAuth').disabled = true;
            
            // æ˜¾ç¤ºæœºå™¨ç 
            if (usageData.computerId) {
                document.getElementById('machineCodeDisplay').textContent = usageData.computerId;
            } else {
                document.getElementById('machineCodeDisplay').textContent = 'æ­£åœ¨ç”Ÿæˆæœºå™¨ç ...';
                // å¦‚æœè¿˜æ²¡æœ‰ç”Ÿæˆç”µè„‘IDï¼Œé‡æ–°ç”Ÿæˆ
                usageData.computerId = generateComputerId();
                document.getElementById('machineCodeDisplay').textContent = usageData.computerId;
            }
            
            // é‡ç½®æˆæƒè¯·æ±‚ç 
            authRequestCode = null;
            document.getElementById('authCodeDisplay').textContent = 'è¯·å…ˆé€‰æ‹©æ‰“èµé‡‘é¢';
            
            // æ˜¾ç¤ºæ”¯ä»˜å¼¹çª—
            document.getElementById('paymentModal').classList.add('active');
        }
        
        // å¤åˆ¶æœºå™¨ç 
        function copyMachineCode() {
            const machineCode = usageData.computerId;
            if (!machineCode) {
                alert('æœºå™¨ç å°šæœªç”Ÿæˆï¼Œè¯·ç¨åå†è¯•');
                return;
            }
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(machineCode).then(() => {
                    alert('æœºå™¨ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                }).catch(err => {
                    // å¦‚æœClipboard APIå¤±è´¥ï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                    fallbackCopyText(machineCode);
                });
            } else {
                // ä¼ ç»Ÿæ–¹æ³•
                fallbackCopyText(machineCode);
            }
        }
        
        // å…³é—­æ”¯ä»˜å¼¹çª—
        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }
        
        // æ˜¾ç¤ºæˆæƒç å¼¹çª—
        function showLicenseModal() {
            document.getElementById('licenseModal').classList.add('active');
            document.getElementById('licenseCode').value = '';
            document.getElementById('licenseStatus').className = 'license-status';
            document.getElementById('licenseStatus').textContent = '';
        }
        
        // å…³é—­æˆæƒç å¼¹çª—
        function closeLicenseModal() {
            document.getElementById('licenseModal').classList.remove('active');
        }
        
        // é€‰æ‹©æ‰“èµé€‰é¡¹
        function selectDonationOption(element) {
            // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰æ‹©çŠ¶æ€
            document.querySelectorAll('.donation-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // è®¾ç½®å½“å‰é€‰é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
            element.classList.add('selected');
            
            // ä¿å­˜é€‰æ‹©
            selectedDonation.amount = parseInt(element.dataset.amount);
            selectedDonation.times = parseInt(element.dataset.times);
            
            // å¯ç”¨ç”Ÿæˆæˆæƒè¯·æ±‚ç æŒ‰é’®
            document.getElementById('btnGenerateAuth').disabled = false;
            document.getElementById('authCodeDisplay').textContent = 'ç‚¹å‡»"ç”Ÿæˆæˆæƒè¯·æ±‚ç "æŒ‰é’®';
        }
        
        // ç”Ÿæˆæˆæƒè¯·æ±‚ç 
        function generateAuthRequestCode() {
            // å¦‚æœæ²¡æœ‰é€‰æ‹©æ‰“èµé‡‘é¢ï¼Œæç¤ºç”¨æˆ·é€‰æ‹©
            if (selectedDonation.amount === 0) {
                alert('è¯·å…ˆé€‰æ‹©æ‰“èµé‡‘é¢');
                return;
            }
            
            // ç”Ÿæˆä¸€æ¬¡æ€§éšæœºç 
            const timestamp = Date.now();
            const randomStr = Math.random().toString(36).substring(2, 10).toUpperCase();
            authRequestCode = `AUTH-REQ-${timestamp}-${randomStr}`;
            
            // æ˜¾ç¤ºæˆæƒè¯·æ±‚ç 
            document.getElementById('authCodeDisplay').textContent = authRequestCode;
            
            // ä¿å­˜æˆæƒè¯·æ±‚ä¿¡æ¯åˆ°localStorage
            const authRequest = {
                code: authRequestCode,
                amount: selectedDonation.amount,
                times: selectedDonation.times,
                machineCode: usageData.computerId,
                generatedAt: new Date().toISOString()
            };
            
            // ä¿å­˜åˆ°localStorage
            let authRequests = localStorage.getItem('authRequests');
            if (authRequests) {
                authRequests = JSON.parse(authRequests);
            } else {
                authRequests = [];
            }
            
            authRequests.push(authRequest);
            localStorage.setItem('authRequests', JSON.stringify(authRequests));
            
            // å¯ç”¨å¤åˆ¶æŒ‰é’®
            document.getElementById('btnCopyAuth').disabled = false;
            
            alert(`æˆæƒè¯·æ±‚ç å·²ç”Ÿæˆï¼\n\nè¯·å¤åˆ¶æ­¤ä»£ç å¹¶ä¸æ”¯ä»˜æˆªå›¾ä¸€èµ·å‘é€åˆ°é‚®ç®±ï¼š65496209@qq.com\n\nå¼€å‘è€…æ”¶åˆ°åï¼Œä¼šå›å¤æˆæƒç ç»™æ‚¨ã€‚`);
        }
        
        // å¤åˆ¶æˆæƒè¯·æ±‚ç 
        function copyAuthRequestCode() {
            if (!authRequestCode) {
                alert('è¯·å…ˆç”Ÿæˆæˆæƒè¯·æ±‚ç ');
                return;
            }
            
            // ä½¿ç”¨ç°ä»£Clipboard API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(authRequestCode).then(() => {
                    alert('æˆæƒè¯·æ±‚ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè¯·å°†ä»£ç å’Œæ”¯ä»˜æˆªå›¾ä¸€èµ·å‘é€åˆ°é‚®ç®±ï¼š65496209@qq.com');
                }).catch(err => {
                    // å¦‚æœClipboard APIå¤±è´¥ï¼Œä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•
                    fallbackCopyText(authRequestCode);
                });
            } else {
                // ä¼ ç»Ÿæ–¹æ³•
                fallbackCopyText(authRequestCode);
            }
        }
        
        // ä¼ ç»Ÿçš„å¤åˆ¶æ–‡æœ¬æ–¹æ³•
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('æˆæƒè¯·æ±‚ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè¯·å°†ä»£ç å’Œæ”¯ä»˜æˆªå›¾ä¸€èµ·å‘é€åˆ°é‚®ç®±ï¼š65496209@qq.com');
            } catch (err) {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æˆæƒè¯·æ±‚ç ');
            }
            
            document.body.removeChild(textArea);
        }
        
        // æ¿€æ´»æˆæƒç 
        function activateLicense() {
            const licenseCode = document.getElementById('licenseCode').value.trim();
            
            if (!licenseCode) {
                showLicenseStatus('error', 'è¯·è¾“å…¥æˆæƒç ');
                return;
            }
            
            // éªŒè¯æˆæƒç æ ¼å¼
            if (!licenseCode.startsWith('AUTH-')) {
                showLicenseStatus('error', 'æˆæƒç æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·æ£€æŸ¥');
                return;
            }
            
            // æ£€æŸ¥æˆæƒç æ˜¯å¦å·²è¢«ä½¿ç”¨
            if (isLicenseUsed(licenseCode)) {
                showLicenseStatus('error', 'æ­¤æˆæƒç å·²è¢«ä½¿ç”¨ï¼Œæ¯ä¸ªæˆæƒç åªèƒ½ä½¿ç”¨ä¸€æ¬¡');
                return;
            }
            
            // æ˜¾ç¤ºéªŒè¯ä¸­çŠ¶æ€
            showLicenseStatus('verifying', 'æ­£åœ¨éªŒè¯æˆæƒç ...');
            
            // æ¨¡æ‹ŸéªŒè¯è¿‡ç¨‹
            setTimeout(() => {
                // å®é™…éªŒè¯é€»è¾‘
                const isValid = verifyLicenseCode(licenseCode);
                
                if (isValid) {
                    // æˆæƒç æœ‰æ•ˆï¼Œå¢åŠ ä½¿ç”¨æ¬¡æ•°
                    const times = getTimesFromLicense(licenseCode);
                    addUsageTimes(times);
                    
                    // ä¿å­˜æˆæƒè®°å½•
                    saveLicenseRecord(licenseCode, times);
                    
                    // æ ‡è®°æˆæƒç ä¸ºå·²ä½¿ç”¨
                    markLicenseAsUsed(licenseCode);
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    showLicenseStatus('success', `æˆæƒæˆåŠŸï¼å·²å¢åŠ ${times}æ¬¡ä½¿ç”¨æƒé™ã€‚`);
                    
                    // å…³é—­å¼¹çª—
                    setTimeout(() => {
                        closeLicenseModal();
                    }, 2000);
                } else {
                    // æˆæƒç æ— æ•ˆ
                    showLicenseStatus('error', 'æˆæƒç æ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·æ£€æŸ¥');
                }
            }, 1500);
        }
        
        // æ£€æŸ¥æˆæƒç æ˜¯å¦å·²è¢«ä½¿ç”¨
        function isLicenseUsed(licenseCode) {
            const usedLicenses = localStorage.getItem('usedLicenses');
            if (usedLicenses) {
                try {
                    const used = JSON.parse(usedLicenses);
                    return used.includes(licenseCode);
                } catch (e) {
                    console.error('æ£€æŸ¥å·²ä½¿ç”¨æˆæƒç æ—¶å‡ºé”™:', e);
                    return false;
                }
            }
            return false;
        }
        
        // æ ‡è®°æˆæƒç ä¸ºå·²ä½¿ç”¨
        function markLicenseAsUsed(licenseCode) {
            let usedLicenses = localStorage.getItem('usedLicenses');
            if (usedLicenses) {
                try {
                    usedLicenses = JSON.parse(usedLicenses);
                } catch (e) {
                    usedLicenses = [];
                }
            } else {
                usedLicenses = [];
            }
            
            if (!usedLicenses.includes(licenseCode)) {
                usedLicenses.push(licenseCode);
                localStorage.setItem('usedLicenses', JSON.stringify(usedLicenses));
            }
        }
        
        // éªŒè¯æˆæƒç 
        function verifyLicenseCode(licenseCode) {
            // æ£€æŸ¥æˆæƒç æ ¼å¼
            const parts = licenseCode.split('-');
            if (parts.length !== 5) return false;
            if (parts[0] !== 'AUTH') return false;
            
            // æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…ï¼ˆ30å¤©å†…ï¼‰
            const timestamp = parseInt(parts[2], 16);
            const now = Date.now();
            const thirtyDays = 30 * 24 * 60 * 60 * 1000;
            
            if (now - timestamp > thirtyDays) {
                return false; // æˆæƒç å·²è¿‡æœŸ
            }
            
            // éªŒè¯ç­¾å
            const expectedSignature = generateSignature(parts[1], parts[2], parts[3]);
            if (parts[4] !== expectedSignature) {
                return false;
            }
            
            return true;
        }
        
        // ä»æˆæƒç ä¸­è·å–ä½¿ç”¨æ¬¡æ•°
        function getTimesFromLicense(licenseCode) {
            const parts = licenseCode.split('-');
            const typeCode = parts[1];
            
            // æ ¹æ®ç±»å‹ä»£ç è¿”å›å¯¹åº”çš„ä½¿ç”¨æ¬¡æ•°
            switch(typeCode) {
                case '001': return 1;  // 8å…ƒ
                case '003': return 3;  // 18å…ƒ
                case '010': return 10; // 58å…ƒ
                case '999': return 9999; // 88å…ƒï¼ˆç»ˆç”Ÿï¼‰
                default: return 1;
            }
        }
        
        // ç”Ÿæˆç­¾åï¼ˆå¼€å‘è€…ç«¯ä½¿ç”¨ç›¸åŒç®—æ³•ï¼‰
        function generateSignature(typeCode, timestamp, randomStr) {
            // ç®€åŒ–çš„ç­¾åç®—æ³•
            const secret = '2026Developer@sy'; // å¼€å‘è€…å¯†é’¥
            const str = `${typeCode}-${timestamp}-${randomStr}-${secret}`;
            
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            return Math.abs(hash).toString(16).substring(0, 4).toUpperCase();
        }
        
        // ä¿å­˜æˆæƒè®°å½•
        function saveLicenseRecord(licenseCode, times) {
            const licenseRecord = {
                licenseCode: licenseCode,
                times: times,
                activatedAt: new Date().toISOString(),
                machineCode: usageData.computerId
            };
            
            // ä¿å­˜åˆ°localStorage
            let licenseRecords = localStorage.getItem('licenseRecords');
            if (licenseRecords) {
                licenseRecords = JSON.parse(licenseRecords);
            } else {
                licenseRecords = [];
            }
            
            licenseRecords.push(licenseRecord);
            localStorage.setItem('licenseRecords', JSON.stringify(licenseRecords));
        }
        
        // æ˜¾ç¤ºæˆæƒçŠ¶æ€
        function showLicenseStatus(type, message) {
            const statusDiv = document.getElementById('licenseStatus');
            statusDiv.className = `license-status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
        }
        
        // æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°å¹¶è®¡ç®—
        function checkUsageAndCalculate() {
            if (!checkUsage()) {
                if (confirm('å…è´¹æ¬¡æ•°å·²ç”¨å®Œï¼\n\nè¯·é€šè¿‡æ‰“èµåŠŸèƒ½æ”¯ä»˜è·å–æ›´å¤šæ¬¡æ•°\n\næ˜¯å¦å‰å¾€æ”¯ä»˜é¡µé¢ï¼Ÿ')) {
                    showPaymentModal();
                }
                return;
            }
            
            // ä½¿ç”¨ä¸€æ¬¡è®¡ç®—åŠŸèƒ½
            if (useOnce()) {
                calculateAllPackages();
            }
        }
        
        // æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°å¹¶å¯¼å‡º
        function checkUsageAndExport() {
            if (!checkUsage()) {
                if (confirm('å…è´¹æ¬¡æ•°å·²ç”¨å®Œï¼\n\nè¯·é€šè¿‡æ‰“èµåŠŸèƒ½æ”¯ä»˜è·å–æ›´å¤šæ¬¡æ•°\n\næ˜¯å¦å‰å¾€æ”¯ä»˜é¡µé¢ï¼Ÿ')) {
                    showPaymentModal();
                }
                return;
            }
            
            // ä½¿ç”¨ä¸€æ¬¡å¯¼å‡ºåŠŸèƒ½
            if (useOnce()) {
                exportSummaryReport();
            }
        }
        
        // æ£€æŸ¥ä½¿ç”¨æ¬¡æ•°å¹¶ç”ŸæˆPDF
        function checkUsageAndPDF() {
            if (!checkUsage()) {
                if (confirm('å…è´¹æ¬¡æ•°å·²ç”¨å®Œï¼\n\nè¯·é€šè¿‡æ‰“èµåŠŸèƒ½æ”¯ä»˜è·å–æ›´å¤šæ¬¡æ•°\n\næ˜¯å¦å‰å¾€æ”¯ä»˜é¡µé¢ï¼Ÿ')) {
                    showPaymentModal();
                }
                return;
            }
            
            // ä½¿ç”¨ä¸€æ¬¡PDFç”ŸæˆåŠŸèƒ½
            if (useOnce()) {
                exportPDFReport();
            }
        }
        
        // ç®—æ³•åˆ‡æ¢å‡½æ•°
        function selectMethod(method) {
            // æ›´æ–°é€‰é¡¹å¡æ ·å¼
            document.querySelectorAll('.method-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.method-tab[data-method="${method}"]`).classList.add('active');
            
            // æ›´æ–°å‚æ•°é¢æ¿
            document.querySelectorAll('.algorithm-params').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${method}Params`).classList.add('active');
            
            // æ›´æ–°ç®—æ³•æ ‡è¯†
            calculationResults.currentAlgorithm = method;
            const algorithmName = method === 'arithmetic' ? 'ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•' : 'åŒºé—´å¤åˆå¹³å‡ä»·æ³•';
            document.getElementById('algorithmBadge').textContent = algorithmName;
            
            // æ›´æ–°åŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•°æ˜¾ç¤º
            if (method === 'interval') {
                updateIntervalParamsDisplay();
            }
        }
        
        // æ›´æ–°åŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•°æ˜¾ç¤º
        function updateIntervalParamsDisplay() {
            const lower = document.getElementById('intervalLower');
            const upper = document.getElementById('intervalUpper');
            const n1 = document.getElementById('n1');
            const n2 = document.getElementById('n2');
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            lower.parentElement.querySelector('.param-value').textContent = `${lower.value}%`;
            upper.parentElement.querySelector('.param-value').textContent = `+${upper.value}%`;
            n1.parentElement.querySelector('.param-value').textContent = n1.value;
            n2.parentElement.querySelector('.param-value').textContent = n2.value;
        }
        
        // é”®ç›˜è¾“å…¥æ£€æµ‹å‡½æ•°
        function detectKeySequence(event) {
            const currentTime = Date.now();
            
            // å¦‚æœæŒ‰é”®é—´éš”è¶…è¿‡2ç§’ï¼Œé‡ç½®åºåˆ—
            if (currentTime - lastKeyTime > 2000) {
                keySequence = '';
            }
            
            // æ›´æ–°æœ€åæŒ‰é”®æ—¶é—´
            lastKeyTime = currentTime;
            
            // æ·»åŠ æŒ‰é”®åˆ°åºåˆ—
            keySequence += event.key;
            
            // ä¿æŒåºåˆ—é•¿åº¦ä¸º10ï¼ˆè¶³å¤Ÿæ£€æµ‹666666å’Œ88888888ï¼‰
            if (keySequence.length > 10) {
                keySequence = keySequence.substring(keySequence.length - 10);
            }
            
            // æ£€æŸ¥æ˜¯å¦è¾“å…¥äº†666666ï¼ˆé‡ç½®ä½¿ç”¨æ¬¡æ•°ï¼‰
            if (keySequence.includes('666666')) {
                // é‡ç½®ä½¿ç”¨æ¬¡æ•°åˆ°å…è´¹3æ¬¡
                resetUsageToFree();
                keySequence = ''; // é‡ç½®åºåˆ—
            }
            
            // æ£€æŸ¥æ˜¯å¦è¾“å…¥äº†88888888ï¼ˆå¢åŠ 8æ¬¡ä½¿ç”¨æ¬¡æ•°ï¼‰
            if (keySequence.includes('88888888')) {
                // å¢åŠ 8æ¬¡ä½¿ç”¨æ¬¡æ•°
                addUsageTimes(8);
                keySequence = ''; // é‡ç½®åºåˆ—
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–ä½¿ç”¨æ¬¡æ•°ç®¡ç†
            initUsage();
            
            // åˆå§‹åŒ–å·¥å…·ç®±
            initToolbox();
            
            // æ·»åŠ å‡ è¡Œåˆå§‹æ•°æ®
            for (let i = 0; i < 3; i++) {
                addRow();
            }
            
            // åˆå§‹åŒ–åŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•°æ˜¾ç¤º
            updateIntervalParamsDisplay();
            
            // ç»‘å®šåŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•°å˜åŒ–äº‹ä»¶
            document.getElementById('intervalLower').addEventListener('input', updateIntervalParamsDisplay);
            document.getElementById('intervalUpper').addEventListener('input', updateIntervalParamsDisplay);
            document.getElementById('n1').addEventListener('input', updateIntervalParamsDisplay);
            document.getElementById('n2').addEventListener('input', updateIntervalParamsDisplay);
            
            // ç»‘å®šé”®ç›˜äº‹ä»¶ç›‘å¬
            document.addEventListener('keydown', detectKeySequence);
            
            // ç‚¹å‡»å‰©ä½™æ¬¡æ•°æ—¶æ˜¾ç¤ºæ”¯ä»˜å¼¹çª—
            document.getElementById('usageCounter').addEventListener('click', function() {
                showPaymentModal();
            });
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²æ¿€æ´»çš„æˆæƒ
            checkActivatedLicenses();
        });
        
        // æ£€æŸ¥å·²æ¿€æ´»çš„æˆæƒ
        function checkActivatedLicenses() {
            const licenseRecords = localStorage.getItem('licenseRecords');
            if (licenseRecords) {
                try {
                    const records = JSON.parse(licenseRecords);
                    const machineRecords = records.filter(record => record.machineCode === usageData.computerId);
                    
                    if (machineRecords.length > 0) {
                        console.log(`æ‰¾åˆ° ${machineRecords.length} æ¡æˆæƒè®°å½•`);
                    }
                } catch (e) {
                    console.error('æ£€æŸ¥æˆæƒè®°å½•æ—¶å‡ºé”™:', e);
                }
            }
        }
        
        // æ·»åŠ æŠ•æ ‡äººè¡Œ
        function addRow() {
            const tableBody = document.getElementById('bidTableBody');
            const rowCount = tableBody.rows.length + 1;
            
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${rowCount}</td>
                <td><input type="text" class="package" placeholder="å¦‚: åŒ…1"></td>
                <td><input type="text" class="region" placeholder="å¦‚: å›½ç½‘æ²³åŒ—çœç”µåŠ›æœ‰é™å…¬å¸"></td>
                <td><input type="text" class="bidder-name" placeholder="è¾“å…¥æŠ•æ ‡äººåç§°"></td>
                <td><input type="number" class="bid-price" value="0" min="0" step="0.01" placeholder="è¾“å…¥è¯„æ ‡æ€»ä»·"></td>
                <td>
                    <select class="qualified">
                        <option value="yes" selected>æ˜¯</option>
                        <option value="no">å¦</option>
                    </select>
                </td>
                <td class="participate-status">-</td>
                <td class="score">-</td>
                <td><button class="btn-remove" onclick="removeRow(this)">åˆ é™¤</button></td>
            `;
            
            tableBody.appendChild(newRow);
        }
        
        // åˆ é™¤æŠ•æ ‡äººè¡Œ
        function removeRow(button) {
            const row = button.closest('tr');
            row.remove();
            updateRowNumbers();
        }
        
        // æ›´æ–°è¡Œå·
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#bidTableBody tr');
            rows.forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
        }
        
        // å¤„ç†Excelæ–‡ä»¶é€‰æ‹©
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // ä¿å­˜æ–‡ä»¶åï¼Œç”¨äºPDFå°é¢
            currentFileName = file.name
                .replace(/_\d{4}-\d{2}-\d{2}_\d+\.xlsx?/i, '') // å»æ‰æ—¶é—´æˆ³
                .replace(/å¼€æ ‡è®°å½•è¡¨/g, '') // å»æ‰"å¼€æ ‡è®°å½•è¡¨"
                .replace(/\.xlsx?$/, '') // å»æ‰æ‰©å±•å
                .trim();
            
            const fileInfo = document.getElementById('fileInfo');
            fileInfo.innerHTML = `å·²é€‰æ‹©æ–‡ä»¶: <strong>${file.name}</strong> (${(file.size / 1024).toFixed(2)} KB)`;
            fileInfo.style.color = '#27ae60';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // å‡è®¾æ•°æ®åœ¨ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                
                // æ¸…ç©ºç°æœ‰è¡¨æ ¼æ•°æ®
                const tableBody = document.getElementById('bidTableBody');
                tableBody.innerHTML = '';
                
                // è§£æExcelæ•°æ®
                let importedCount = 0;
                
                // æ ¹æ®æä¾›çš„Excelç»“æ„ï¼šåˆ—ç´¢å¼•å¯¹åº”å…³ç³»
                for (let i = 1; i < jsonData.length; i++) {
                    const rowData = jsonData[i];
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ•°æ®åˆ—
                    if (rowData && rowData.length >= 10) {
                        // åŒ…å·åœ¨Eåˆ—ï¼Œç´¢å¼•ä¸º4
                        const packageNo = rowData[4] || '';
                        const region = rowData[6] || '';
                        const bidderName = rowData[7] || '';
                        const price = parseFloat(rowData[9]) || 0;
                        
                        // è·³è¿‡ç©ºè¡Œ
                        if (!packageNo && !bidderName && price === 0) continue;
                        
                        const newRow = document.createElement('tr');
                        newRow.innerHTML = `
                            <td>${importedCount + 1}</td>
                            <td><input type="text" class="package" value="${packageNo}"></td>
                            <td><input type="text" class="region" value="${region}"></td>
                            <td><input type="text" class="bidder-name" value="${bidderName}"></td>
                            <td><input type="number" class="bid-price" value="${price}" min="0" step="0.01"></td>
                            <td>
                                <select class="qualified">
                                    <option value="yes" selected>æ˜¯</option>
                                    <option value="no">å¦</option>
                                </select>
                            </td>
                            <td class="participate-status">-</td>
                            <td class="score">-</td>
                            <td><button class="btn-remove" onclick="removeRow(this)">åˆ é™¤</button></td>
                        `;
                        
                        tableBody.appendChild(newRow);
                        importedCount++;
                    }
                }
                
                if (importedCount > 0) {
                    fileInfo.innerHTML += `<br>æˆåŠŸå¯¼å…¥ <strong>${importedCount}</strong> æ¡æŠ•æ ‡æ•°æ®`;
                    alert(`æˆåŠŸå¯¼å…¥ ${importedCount} æ¡æŠ•æ ‡æ•°æ®ï¼Œè¯·ç‚¹å‡»"è®¡ç®—å„åŒ…ä»·æ ¼å¾—åˆ†"æŒ‰é’®è¿›è¡Œè®¡ç®—ã€‚`);
                } else {
                    fileInfo.innerHTML += `<br>æœªèƒ½æ‰¾åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥Excelæ–‡ä»¶æ ¼å¼`;
                    fileInfo.style.color = '#e74c3c';
                    
                    // å°è¯•æ˜¾ç¤ºè¡¨å¤´ä»¥å¸®åŠ©è°ƒè¯•
                    if (jsonData.length > 0) {
                        console.log('Excelè¡¨å¤´:', jsonData[0]);
                        fileInfo.innerHTML += `<br>æ£€æµ‹åˆ°çš„è¡¨å¤´: ${jsonData[0].join(', ')}`;
                    }
                }
            };
            
            reader.onerror = function() {
                fileInfo.innerHTML = `æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•`;
                fileInfo.style.color = '#e74c3c';
            };
            
            reader.readAsArrayBuffer(file);
        }
        
        // æŒ‰åŒ…è®¡ç®—ä»·æ ¼å¾—åˆ† - æ”¯æŒä¸¤ç§ç®—æ³•
        function calculateAllPackages() {
            // æ ¹æ®å½“å‰é€‰æ‹©çš„ç®—æ³•è·å–å‚æ•°
            const algorithm = calculationResults.currentAlgorithm;
            let algorithmParams = {};
            
            if (algorithm === 'arithmetic') {
                // ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•å‚æ•°
                const c = parseFloat(document.getElementById('floatCoefficient').value) / 100;
                algorithmParams = { c, algorithm: 'arithmetic' };
            } else {
                // åŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•°
                const lower = parseFloat(document.getElementById('intervalLower').value) / 100;
                const upper = parseFloat(document.getElementById('intervalUpper').value) / 100;
                const n1 = parseFloat(document.getElementById('n1').value);
                const n2 = parseFloat(document.getElementById('n2').value);
                algorithmParams = { lower, upper, n1, n2, algorithm: 'interval' };
            }
            
            // è·å–æ‰€æœ‰æŠ•æ ‡äººæ•°æ®å¹¶æŒ‰åŒ…åˆ†ç»„
            const rows = document.querySelectorAll('#bidTableBody tr');
            const biddersByPackage = {};
            
            // æ”¶é›†æ‰€æœ‰æŠ•æ ‡äººæ•°æ®
            rows.forEach(row => {
                const packageNo = row.querySelector('.package').value || 'æœªåˆ†ç»„';
                const region = row.querySelector('.region').value || '';
                const name = row.querySelector('.bidder-name').value || 'æœªçŸ¥æŠ•æ ‡äºº';
                const price = parseFloat(row.querySelector('.bid-price').value) || 0;
                const qualified = row.querySelector('.qualified').value === 'yes';
                
                if (!biddersByPackage[packageNo]) {
                    biddersByPackage[packageNo] = [];
                }
                
                biddersByPackage[packageNo].push({
                    package: packageNo,
                    region,
                    name,
                    price,
                    qualified,
                    row: row
                });
            });
            
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            calculationResults.packages = {};
            calculationResults.allBidders = [];
            calculationResults.bidderFullScoreStats = {};
            
            const packageResultsContainer = document.getElementById('packageResultsContainer');
            packageResultsContainer.innerHTML = '';
            
            // å¯¹æ¯ä¸ªåŒ…è¿›è¡Œè®¡ç®—
            Object.keys(biddersByPackage).forEach(packageNo => {
                const packageBidders = biddersByPackage[packageNo];
                
                // è®¡ç®—åˆæ ¼æŠ•æ ‡äººï¼ˆè¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººï¼‰
                const qualifiedBidders = packageBidders.filter(b => b.qualified);
                const qualifiedCount = qualifiedBidders.length;
                
                if (qualifiedCount === 0) {
                    // å¦‚æœæ²¡æœ‰åˆæ ¼æŠ•æ ‡äººï¼Œè·³è¿‡è¯¥åŒ…
                    return;
                }
                
                let result = {};
                
                // æ ¹æ®ç®—æ³•ç±»å‹è¿›è¡Œè®¡ç®—
                if (algorithm === 'arithmetic') {
                    result = calculateArithmeticMethod(packageNo, packageBidders, algorithmParams);
                } else {
                    result = calculateIntervalMethod(packageNo, packageBidders, algorithmParams);
                }
                
                // æ›´æ–°è¡¨æ ¼æ˜¾ç¤º
                packageBidders.forEach(bidder => {
                    const row = bidder.row;
                    const participateCell = row.querySelector('.participate-status');
                    const scoreCell = row.querySelector('.score');
                    
                    // æ£€æŸ¥æ˜¯å¦æ˜¯"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"ï¼Œå¦‚æœæ˜¯åˆ™æ·»åŠ çº¢è‰²é«˜äº®ç±»
                    if (bidder.name.includes('èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸')) {
                        row.classList.add('red-highlight');
                    }
                    
                    if (!bidder.qualified) {
                        participateCell.textContent = 'ä¸å‚ä¸ï¼ˆæœªé€šè¿‡è¯„å®¡ï¼‰';
                        participateCell.style.color = '#e74c3c';
                        scoreCell.textContent = '0';
                        scoreCell.style.color = '#e74c3c';
                    } else if (!bidder.participates) {
                        participateCell.textContent = algorithm === 'arithmetic' ? 'ä¸å‚ä¸ï¼ˆä½äºA1å€¼30%ï¼‰' : 'ä¸å‚ä¸ï¼ˆåŒºé—´å¤–ï¼‰';
                        participateCell.style.color = '#e67e22';
                        scoreCell.textContent = bidder.score;
                        scoreCell.style.color = '#e67e22';
                    } else {
                        participateCell.textContent = 'å‚ä¸';
                        participateCell.style.color = '#27ae60';
                        scoreCell.textContent = bidder.score;
                        scoreCell.style.color = '#27ae60';
                        
                        // é«˜äº®æ˜¾ç¤ºå¾—åˆ†æœ€é«˜çš„æŠ•æ ‡äºº
                        const qualifiedBidders = packageBidders.filter(b => b.qualified);
                        if (qualifiedBidders.length > 0 && bidder.score === Math.max(...qualifiedBidders.map(b => b.score))) {
                            scoreCell.classList.add('highlight');
                        } else {
                            scoreCell.classList.remove('highlight');
                        }
                    }
                });
                
                // ä¿å­˜åŒ…çš„è®¡ç®—ç»“æœ
                calculationResults.packages[packageNo] = result;
                
                // åˆ›å»ºåŒ…ç»“æœæ˜¾ç¤º
                const packageResult = document.createElement('div');
                packageResult.className = 'package-result-item';
                
                // æ‰¾å‡ºæ»¡åˆ†æŠ•æ ‡äºº
                const fullScoreBidders = packageBidders
                    .filter(b => b.qualified && b.score === 100)
                    .map(b => b.name);
                
                let statsHTML = '';
                if (algorithm === 'arithmetic') {
                    statsHTML = `
                        <div class="package-stats">
                            <div class="stat-item">
                                <div class="stat-label">M2æŠ•æ ‡äººæ•°é‡</div>
                                <div class="stat-value">${result.m2Count}ä¸ª</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">å¹³å‡ä»·A1</div>
                                <div class="stat-value">${result.a1}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">M3æŠ•æ ‡äººæ•°é‡</div>
                                <div class="stat-value">${result.m3Count}ä¸ª</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">å¹³å‡ä»·A2</div>
                                <div class="stat-value">${result.a2}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">æµ®åŠ¨ç³»æ•°C</div>
                                <div class="stat-value">${result.c}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">åŸºå‡†ä»·A3</div>
                                <div class="stat-value highlight">${result.a3}</div>
                            </div>
                        </div>
                    `;
                } else {
                    statsHTML = `
                        <div class="package-stats">
                            <div class="stat-item">
                                <div class="stat-label">åˆæ ¼æŠ•æ ‡äººæ•°é‡</div>
                                <div class="stat-value">${result.qualifiedCount}ä¸ª</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">å¹³å‡ä»·A1</div>
                                <div class="stat-value">${result.a1}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">åŒºé—´å†…æŠ•æ ‡äººæ•°</div>
                                <div class="stat-value">${result.intervalCount}ä¸ª</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">åŒºé—´ä¸‹é™ç³»æ•°b</div>
                                <div class="stat-value">${result.lower}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">åŒºé—´ä¸Šé™ç³»æ•°c</div>
                                <div class="stat-value">${result.upper}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">åŸºå‡†ä»·</div>
                                <div class="stat-value highlight">${result.benchmark}</div>
                            </div>
                        </div>
                    `;
                }
                
                packageResult.innerHTML = `
                    <div class="package-header">
                        <div class="package-title">${packageNo} - ${packageBidders[0]?.region || 'æœªçŸ¥åŒºåŸŸ'}</div>
                        <div class="result-value">åŸºå‡†ä»·: ${algorithm === 'arithmetic' ? result.a3 : result.benchmark}ä¸‡å…ƒ</div>
                    </div>
                    ${statsHTML}
                    ${fullScoreBidders.length > 0 ? `
                    <div class="full-score-bidders">
                        <div class="full-score-title">æ»¡åˆ†æŠ•æ ‡äºº (${fullScoreBidders.length}ä¸ª):</div>
                        <div class="full-score-list">
                            ${fullScoreBidders.map(bidder => {
                                // æ£€æŸ¥æ˜¯å¦æ˜¯"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"ï¼Œå¦‚æœæ˜¯åˆ™çº¢è‰²æ˜¾ç¤º
                                const isSpecial = bidder.includes('èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸');
                                return `<div class="full-score-bidder ${isSpecial ? 'red-highlight' : ''}">${bidder}</div>`;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                `;
                
                packageResultsContainer.appendChild(packageResult);
            });
            
            // ç”Ÿæˆæ±‡æ€»æŠ¥è¡¨
            generateSummaryReport();
            
            const packageCount = Object.keys(biddersByPackage).length;
            const algorithmName = algorithm === 'arithmetic' ? 'ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•' : 'åŒºé—´å¤åˆå¹³å‡ä»·æ³•';
            alert(`è®¡ç®—å®Œæˆï¼ä½¿ç”¨${algorithmName}è®¡ç®—äº†${packageCount}ä¸ªåŒ…çš„ä»·æ ¼å¾—åˆ†ã€‚`);
        }
        
        // ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•è®¡ç®—
        function calculateArithmeticMethod(packageNo, packageBidders, params) {
            const { c } = params;
            
            // è®¡ç®—M2æŠ•æ ‡äººï¼ˆé€šè¿‡åˆæ­¥è¯„å®¡çš„åˆæ ¼æŠ•æ ‡äººï¼‰
            const m2Bidders = packageBidders.filter(b => b.qualified);
            const m2Count = m2Bidders.length;
            
            // è®¡ç®—A1ï¼šM2æŠ•æ ‡äººè¯„æ ‡ä»·çš„å¹³å‡å€¼
            const a1 = m2Bidders.reduce((sum, b) => sum + b.price, 0) / m2Count;
            
            // ç­›é€‰M3æŠ•æ ‡äººï¼ˆä¸ä½äºA1å€¼30%çš„æŠ¥ä»·ï¼‰
            const threshold = a1 * 0.7; // ä½äºA1å€¼30%çš„ä¸å‚ä¸
            const m3Bidders = m2Bidders.filter(b => b.price >= threshold);
            const m3Count = m3Bidders.length;
            
            // è®¡ç®—A2ï¼šM3æŠ•æ ‡äººè¯„æ ‡ä»·çš„å¹³å‡å€¼
            const a2 = m3Bidders.reduce((sum, b) => sum + b.price, 0) / m3Count;
            
            // è®¡ç®—åŸºå‡†ä»·A3 = A2 Ã— (1 + C)
            const a3 = a2 * (1 + c);
            
            // è®¡ç®—æ¯ä¸ªæŠ•æ ‡äººçš„ä»·æ ¼å¾—åˆ†
            packageBidders.forEach(bidder => {
                // å¦‚æœä¸æ˜¯åˆæ ¼æŠ•æ ‡äººï¼Œå¾—åˆ†ä¸º0
                if (!bidder.qualified) {
                    bidder.score = 0;
                    bidder.participates = false;
                    return;
                }
                
                // åˆ¤æ–­æ˜¯å¦å‚ä¸åŸºå‡†ä»·è®¡ç®—
                bidder.participates = bidder.price >= threshold;
                
                // è®¡ç®—ä»·æ ¼å¾—åˆ†
                if (bidder.price >= a3) {
                    // å½“æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· â‰¥ åŸºå‡†ä»·ï¼Œn=2.0
                    const score = 100 - 100 * 2.0 * Math.abs(bidder.price - a3) / a3;
                    bidder.score = Math.max(score, 0); // å¾—åˆ†ä¸èƒ½å°äº0
                } else {
                    // å½“æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· < åŸºå‡†ä»·ï¼Œn=0ï¼Œå¾—åˆ†ä¸º100
                    bidder.score = 100;
                }
                
                // æ ¼å¼åŒ–å¾—åˆ†ä¸ºä¸¤ä½å°æ•°
                bidder.score = Math.round(bidder.score * 100) / 100;
                
                // æ·»åŠ åˆ°æ‰€æœ‰æŠ•æ ‡äººåˆ—è¡¨
                calculationResults.allBidders.push({
                    package: bidder.package,
                    region: bidder.region,
                    name: bidder.name,
                    price: bidder.price,
                    qualified: bidder.qualified,
                    participates: bidder.participates,
                    score: bidder.score,
                    algorithm: 'arithmetic'
                });
                
                // ç»Ÿè®¡æ»¡åˆ†æŠ•æ ‡äºº
                if (bidder.qualified && bidder.score === 100) {
                    if (!calculationResults.bidderFullScoreStats[bidder.name]) {
                        calculationResults.bidderFullScoreStats[bidder.name] = {
                            count: 0,
                            packages: [],
                            algorithm: 'arithmetic'
                        };
                    }
                    calculationResults.bidderFullScoreStats[bidder.name].count++;
                    calculationResults.bidderFullScoreStats[bidder.name].packages.push(bidder.package);
                }
            });
            
            return {
                m2Count,
                a1: a1.toFixed(2),
                m3Count,
                a2: a2.toFixed(2),
                c: (c * 100).toFixed(2) + '%',
                a3: a3.toFixed(2),
                bidders: packageBidders.map(b => ({
                    name: b.name,
                    price: b.price,
                    qualified: b.qualified,
                    participates: b.participates,
                    score: b.score
                })),
                algorithm: 'arithmetic'
            };
        }
        
        // åŒºé—´å¤åˆå¹³å‡ä»·æ³•è®¡ç®—
        function calculateIntervalMethod(packageNo, packageBidders, params) {
            const { lower, upper, n1, n2 } = params;
            
            // è®¡ç®—åˆæ ¼æŠ•æ ‡äººï¼ˆè¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººï¼‰
            const qualifiedBidders = packageBidders.filter(b => b.qualified);
            const qualifiedCount = qualifiedBidders.length;
            
            // è®¡ç®—A1ï¼šåˆæ ¼æŠ•æ ‡äººè¯„æ ‡ä»·çš„ç®—æœ¯å¹³å‡å€¼
            const a1 = qualifiedBidders.reduce((sum, b) => sum + b.price, 0) / qualifiedCount;
            
            // è®¡ç®—åŒºé—´èŒƒå›´
            const lowerBound = a1 * (1 + lower);
            const upperBound = a1 * (1 + upper);
            
            // åˆ¤æ–­æŠ•æ ‡ä»·æ˜¯å¦åœ¨åŒºé—´å†…
            const intervalBidders = qualifiedBidders.filter(b => b.price >= lowerBound && b.price <= upperBound);
            const intervalCount = intervalBidders.length;
            
            let benchmark;
            let participatesStatus = {};
            
            // è®¡ç®—åŸºå‡†ä»·
            if (intervalCount === 0) {
                // æ‰€æœ‰æŠ•æ ‡ä»·éƒ½åœ¨åŒºé—´å¤–
                // è®¡ç®—æ‰€æœ‰åˆæ ¼æŠ•æ ‡äººè¯„æ ‡ä»·çš„ç®—æœ¯å¹³å‡å€¼ä¸æ‰€æœ‰è¯„æ ‡ä»·æœ€å°å€¼ä¸¤è€…çš„å¹³å‡å€¼
                const minPrice = Math.min(...qualifiedBidders.map(b => b.price));
                benchmark = (a1 + minPrice) / 2;
                
                // æ‰€æœ‰åˆæ ¼æŠ•æ ‡äººéƒ½å‚ä¸åŸºå‡†ä»·è®¡ç®—
                qualifiedBidders.forEach(b => {
                    participatesStatus[b.name] = true;
                });
            } else {
                // å­˜åœ¨æŠ•æ ‡ä»·åœ¨åŒºé—´å†…
                // è®¡ç®—åŒºé—´å†…æŠ•æ ‡äººè¯„æ ‡ä»·çš„ç®—æœ¯å¹³å‡å€¼
                benchmark = intervalBidders.reduce((sum, b) => sum + b.price, 0) / intervalCount;
                
                // åªæœ‰åŒºé—´å†…çš„æŠ•æ ‡äººå‚ä¸åŸºå‡†ä»·è®¡ç®—
                qualifiedBidders.forEach(b => {
                    participatesStatus[b.name] = (b.price >= lowerBound && b.price <= upperBound);
                });
            }
            
            // è®¡ç®—æ¯ä¸ªæŠ•æ ‡äººçš„ä»·æ ¼å¾—åˆ†
            packageBidders.forEach(bidder => {
                // å¦‚æœä¸æ˜¯åˆæ ¼æŠ•æ ‡äººï¼Œå¾—åˆ†ä¸º0
                if (!bidder.qualified) {
                    bidder.score = 0;
                    bidder.participates = false;
                    return;
                }
                
                // åˆ¤æ–­æ˜¯å¦å‚ä¸åŸºå‡†ä»·è®¡ç®—
                bidder.participates = participatesStatus[bidder.name] || false;
                
                // è®¡ç®—ä»·æ ¼å¾—åˆ†
                const n = bidder.price >= benchmark ? n1 : n2;
                const score = 100 - 100 * n * Math.abs(bidder.price - benchmark) / benchmark;
                bidder.score = Math.max(score, 0); // å¾—åˆ†ä¸èƒ½å°äº0
                
                // æ ¼å¼åŒ–å¾—åˆ†ä¸ºä¸¤ä½å°æ•°
                bidder.score = Math.round(bidder.score * 100) / 100;
                
                // æ·»åŠ åˆ°æ‰€æœ‰æŠ•æ ‡äººåˆ—è¡¨
                calculationResults.allBidders.push({
                    package: bidder.package,
                    region: bidder.region,
                    name: bidder.name,
                    price: bidder.price,
                    qualified: bidder.qualified,
                    participates: bidder.participates,
                    score: bidder.score,
                    algorithm: 'interval'
                });
                
                // ç»Ÿè®¡æ»¡åˆ†æŠ•æ ‡äºº
                if (bidder.qualified && bidder.score === 100) {
                    if (!calculationResults.bidderFullScoreStats[bidder.name]) {
                        calculationResults.bidderFullScoreStats[bidder.name] = {
                            count: 0,
                            packages: [],
                            algorithm: 'interval'
                        };
                    }
                    calculationResults.bidderFullScoreStats[bidder.name].count++;
                    calculationResults.bidderFullScoreStats[bidder.name].packages.push(bidder.package);
                }
            });
            
            return {
                qualifiedCount,
                a1: a1.toFixed(2),
                intervalCount,
                lower: (lower * 100).toFixed(0) + '%',
                upper: '+' + (upper * 100).toFixed(0) + '%',
                benchmark: benchmark.toFixed(2),
                bidders: packageBidders.map(b => ({
                    name: b.name,
                    price: b.price,
                    qualified: b.qualified,
                    participates: b.participates,
                    score: b.score
                })),
                algorithm: 'interval'
            };
        }
        
        // ç”Ÿæˆæ±‡æ€»æŠ¥è¡¨
        function generateSummaryReport() {
            const summaryContainer = document.getElementById('summaryContainer');
            
            if (Object.keys(calculationResults.packages).length === 0) {
                summaryContainer.innerHTML = '<p>æš‚æ— è®¡ç®—ç»“æœï¼Œè¯·å…ˆè¿›è¡Œè®¡ç®—ã€‚</p>';
                return;
            }
            
            const algorithm = calculationResults.currentAlgorithm;
            const algorithmName = algorithm === 'arithmetic' ? 'ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•' : 'åŒºé—´å¤åˆå¹³å‡ä»·æ³•';
            
            // æ±‡æ€»æ‰€æœ‰åŒ…çš„æ»¡åˆ†æŠ•æ ‡äºº
            let allFullScoreBidders = [];
            let packageCount = Object.keys(calculationResults.packages).length;
            let totalFullScoreCount = 0;
            
            Object.keys(calculationResults.packages).forEach(packageNo => {
                const packageData = calculationResults.packages[packageNo];
                const fullScoreBidders = packageData.bidders
                    .filter(b => b.qualified && b.score === 100)
                    .map(b => ({
                        package: packageNo,
                        name: b.name,
                        price: b.price
                    }));
                
                allFullScoreBidders = allFullScoreBidders.concat(fullScoreBidders);
                totalFullScoreCount += fullScoreBidders.length;
            });
            
            // åˆ›å»ºæ±‡æ€»è¡¨æ ¼
            let summaryHTML = `
                <div class="result-box">
                    <div class="result-item">
                        <span class="result-label">ä½¿ç”¨ç®—æ³•:</span>
                        <span class="result-value">${algorithmName}</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æ€»åŒ…æ•°:</span>
                        <span class="result-value">${packageCount}ä¸ª</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">æ€»æŠ•æ ‡äººæ•°:</span>
                        <span class="result-value">${calculationResults.allBidders.length}ä¸ª</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">åˆæ ¼æŠ•æ ‡äººæ•°:</span>
                        <span class="result-value">${calculationResults.allBidders.filter(b => b.qualified).length}ä¸ª</span>
                    </div>
                    <div class="result-item highlight">
                        <span class="result-label">æ»¡åˆ†æŠ•æ ‡äººæ€»æ•°:</span>
                        <span class="result-value">${totalFullScoreCount}ä¸ª</span>
                    </div>
                </div>
            `;
            
            // æ·»åŠ æŠ•æ ‡äººæ»¡åˆ†åŒ…æ•°é‡ç»Ÿè®¡
            summaryHTML += `
                <div class="bidder-fullscore-count">
                    <h4>æŠ•æ ‡äººè·å¾—æ»¡åˆ†åŒ…æ•°é‡ç»Ÿè®¡ï¼ˆæŒ‰æ•°é‡ä»å¤šåˆ°å°‘æ’åˆ—ï¼‰</h4>
                    <div class="table-container">
                        <table class="summary-table">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>æŠ•æ ‡äººåç§°</th>
                                    <th>è·å¾—æ»¡åˆ†åŒ…æ•°é‡</th>
                                    <th>æ»¡åˆ†åŒ…åˆ—è¡¨</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            // å°†æŠ•æ ‡äººæ»¡åˆ†ç»Ÿè®¡è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            const bidderStatsArray = Object.entries(calculationResults.bidderFullScoreStats)
                .map(([name, stats]) => ({
                    name,
                    count: stats.count,
                    packages: stats.packages,
                    algorithm: stats.algorithm
                }))
                .sort((a, b) => b.count - a.count); // æŒ‰æ•°é‡ä»å¤šåˆ°å°‘æ’åº
            
            bidderStatsArray.forEach((bidder, index) => {
                // æ£€æŸ¥æ˜¯å¦æ˜¯"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"ï¼Œå¦‚æœæ˜¯åˆ™çº¢è‰²é«˜äº®
                const isSpecial = bidder.name.includes('èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸');
                const rowClass = isSpecial ? 'red-highlight' : '';
                
                summaryHTML += `
                    <tr class="${rowClass}">
                        <td>${index + 1}</td>
                        <td>${bidder.name}</td>
                        <td><strong>${bidder.count}</strong> ä¸ª</td>
                        <td>${bidder.packages.join(', ')}</td>
                    </tr>
                `;
            });
            
            summaryHTML += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // æ·»åŠ å„åŒ…æ±‡æ€»è¡¨
            summaryHTML += `
                <h4>å„åŒ…è®¡ç®—ç»“æœæ±‡æ€»</h4>
                <div class="table-container">
                    <table class="summary-table">
                        <thead>
                            <tr>
            `;
            
            if (algorithm === 'arithmetic') {
                summaryHTML += `
                    <th>åŒ…å·</th>
                    <th>åŒºåŸŸ</th>
                    <th>M2æŠ•æ ‡äººæ•°</th>
                    <th>å¹³å‡ä»·A1(ä¸‡å…ƒ)</th>
                    <th>M3æŠ•æ ‡äººæ•°</th>
                    <th>å¹³å‡ä»·A2(ä¸‡å…ƒ)</th>
                    <th>åŸºå‡†ä»·A3(ä¸‡å…ƒ)</th>
                    <th>æ»¡åˆ†æŠ•æ ‡äººæ•°</th>
                `;
            } else {
                summaryHTML += `
                    <th>åŒ…å·</th>
                    <th>åŒºåŸŸ</th>
                    <th>åˆæ ¼æŠ•æ ‡äººæ•°</th>
                    <th>å¹³å‡ä»·A1(ä¸‡å…ƒ)</th>
                    <th>åŒºé—´å†…äººæ•°</th>
                    <th>åŸºå‡†ä»·(ä¸‡å…ƒ)</th>
                    <th>æ»¡åˆ†æŠ•æ ‡äººæ•°</th>
                `;
            }
            
            summaryHTML += `
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            Object.keys(calculationResults.packages).forEach(packageNo => {
                const packageData = calculationResults.packages[packageNo];
                const region = calculationResults.allBidders.find(b => b.package === packageNo)?.region || '';
                const fullScoreCount = packageData.bidders.filter(b => b.qualified && b.score === 100).length;
                
                if (algorithm === 'arithmetic') {
                    summaryHTML += `
                        <tr>
                            <td>${packageNo}</td>
                            <td>${region}</td>
                            <td>${packageData.m2Count}</td>
                            <td>${packageData.a1}</td>
                            <td>${packageData.m3Count}</td>
                            <td>${packageData.a2}</td>
                            <td class="highlight">${packageData.a3}</td>
                            <td>${fullScoreCount}</td>
                        </tr>
                    `;
                } else {
                    summaryHTML += `
                        <tr>
                            <td>${packageNo}</td>
                            <td>${region}</td>
                            <td>${packageData.qualifiedCount}</td>
                            <td>${packageData.a1}</td>
                            <td>${packageData.intervalCount}</td>
                            <td class="highlight">${packageData.benchmark}</td>
                            <td>${fullScoreCount}</td>
                        </tr>
                    `;
                }
            });
            
            summaryHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            // æ·»åŠ æ‰€æœ‰æŠ•æ ‡äººæ˜ç»†ï¼ˆæŒ‰åŒ…å·åˆ†åˆ«æ’åºï¼Œæ¯ä¸ªåŒ…å†…æŒ‰å¾—åˆ†é™åºæ’åˆ—ï¼‰
            summaryHTML += `
                <h4>æ‰€æœ‰æŠ•æ ‡äººæ˜ç»†ï¼ˆæŒ‰åŒ…å·åˆ†åˆ«æ’åºï¼Œæ¯ä¸ªåŒ…å†…æŒ‰å¾—åˆ†é™åºæ’åˆ—ï¼‰</h4>
                <div class="table-container">
                    <table class="summary-table">
                        <thead>
                            <tr>
                                <th>åŒ…å†…æ’å</th>
                                <th>åŒ…å·</th>
                                <th>åŒºåŸŸ</th>
                                <th>æŠ•æ ‡äººåç§°</th>
                                <th>è¯„æ ‡æ€»ä»·(ä¸‡å…ƒ)</th>
                                <th>é€šè¿‡åˆæ­¥è¯„å®¡</th>
                                <th>å‚ä¸åŸºå‡†ä»·è®¡ç®—</th>
                                <th>ä»·æ ¼å¾—åˆ†</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            // è·å–æ‰€æœ‰åŒ…å·å¹¶æŒ‰å­—æ¯/æ•°å­—é¡ºåºæ’åº
            const allPackageNos = Object.keys(calculationResults.packages).sort();
            
            // éå†æ¯ä¸ªåŒ…
            allPackageNos.forEach(packageNo => {
                // æ·»åŠ åŒ…å·åˆ†éš”è¡Œ
                summaryHTML += `
                    <tr class="package-divider">
                        <td colspan="8"><strong>${packageNo} - ${calculationResults.packages[packageNo].bidders[0]?.region || 'æœªçŸ¥åŒºåŸŸ'}</strong></td>
                    </tr>
                `;
                
                // è·å–å½“å‰åŒ…çš„æŠ•æ ‡äººæ•°æ®ï¼Œå¹¶æŒ‰å¾—åˆ†é™åºæ’åº
                const packageBidders = calculationResults.packages[packageNo].bidders
                    .sort((a, b) => b.score - a.score);
                
                // æ˜¾ç¤ºå½“å‰åŒ…çš„æŠ•æ ‡äºº
                packageBidders.forEach((bidder, index) => {
                    // æ£€æŸ¥æ˜¯å¦æ˜¯"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"ï¼Œå¦‚æœæ˜¯åˆ™çº¢è‰²é«˜äº®
                    const isSpecial = bidder.name.includes('èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸');
                    const rowClass = isSpecial ? 'red-highlight' : '';
                    
                    // æ ¹æ®å¾—åˆ†è®¾ç½®ä¸åŒçš„æ ·å¼ç±»
                    let scoreClass = '';
                    if (bidder.score === 100) {
                        scoreClass = 'score-100';
                    } else if (bidder.score >= 80) {
                        scoreClass = 'score-high';
                    } else if (bidder.score >= 60) {
                        scoreClass = 'score-medium';
                    } else if (bidder.score > 0) {
                        scoreClass = 'score-low';
                    } else {
                        scoreClass = 'score-0';
                    }
                    
                    summaryHTML += `
                        <tr class="${rowClass}">
                            <td>${index + 1}</td>
                            <td>${packageNo}</td>
                            <td>${calculationResults.allBidders.find(b => b.package === packageNo && b.name === bidder.name)?.region || ''}</td>
                            <td>${bidder.name}</td>
                            <td>${bidder.price.toFixed(2)}</td>
                            <td>${bidder.qualified ? 'æ˜¯' : 'å¦'}</td>
                            <td>${bidder.participates ? 'æ˜¯' : 'å¦'}</td>
                            <td class="${scoreClass}">${bidder.score}</td>
                        </tr>
                    `;
                });
            });
            
            summaryHTML += `
                        </tbody>
                    </table>
                </div>
            `;
            
            summaryContainer.innerHTML = summaryHTML;
        }
        
        // å¯¼å‡ºæ±‡æ€»æŠ¥è¡¨
        function exportSummaryReport() {
            // å¦‚æœæ²¡æœ‰è®¡ç®—ç»“æœï¼Œå…ˆè®¡ç®—
            if (Object.keys(calculationResults.packages).length === 0) {
                const confirmCalc = confirm('å°šæœªè®¡ç®—ä»·æ ¼å¾—åˆ†ï¼Œæ˜¯å¦å…ˆè¿›è¡Œè®¡ç®—ï¼Ÿ');
                if (confirmCalc) {
                    calculateAllPackages();
                } else {
                    return;
                }
            }
            
            // åˆ›å»ºå·¥ä½œç°¿
            const wb = XLSX.utils.book_new();
            const algorithm = calculationResults.currentAlgorithm;
            const algorithmName = algorithm === 'arithmetic' ? 'ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•' : 'åŒºé—´å¤åˆå¹³å‡ä»·æ³•';
            
            // 1. ç®—æ³•è¯´æ˜
            const wsAlgorithmData = [
                ['æŠ•æ ‡ä»·æ ¼è¯„åˆ†è®¡ç®—å…¬å¼è¯´æ˜'],
                [''],
                ['ä½¿ç”¨ç®—æ³•:', algorithmName],
                ['è®¡ç®—æ—¶é—´:', new Date().toLocaleString('zh-CN')]
            ];
            
            if (algorithm === 'arithmetic') {
                wsAlgorithmData.push(['æµ®åŠ¨ç³»æ•°C:', document.getElementById('floatCoefficient').value + '%']);
                wsAlgorithmData.push(['']);
                wsAlgorithmData.push(['ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•è¯´æ˜']);
                wsAlgorithmData.push(['æ ¹æ®æ‹›æ ‡æ–‡ä»¶è§„å®šï¼Œå¯¼çº¿åˆ†æ ‡é‡‡ç”¨ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•è®¡ç®—ä»·æ ¼è¯„å®¡å¾—åˆ†ï¼š']);
                wsAlgorithmData.push(['1. è®¡ç®—M2æŠ•æ ‡äººï¼ˆé€šè¿‡æ‰€æœ‰åˆæ­¥è¯„å®¡çš„åˆæ ¼æŠ•æ ‡äººï¼‰è¯„æ ‡ä»·çš„å¹³å‡å€¼A1']);
                wsAlgorithmData.push(['2. æ’é™¤M2ä¸­ä½äºA1å€¼30%ï¼ˆä¸å«30%ï¼‰çš„æŠ¥ä»·ï¼Œå‰©ä½™M3ä¸ªæŠ•æ ‡äººå‚ä¸åŸºå‡†ä»·è®¡ç®—']);
                wsAlgorithmData.push(['3. è®¡ç®—M3ä¸ªæŠ•æ ‡äººè¯„æ ‡ä»·çš„å¹³å‡å€¼A2']);
                wsAlgorithmData.push(['4. è®¡ç®—åŸºå‡†ä»·A3 = A2 Ã— (1 + æµ®åŠ¨ç³»æ•°C)ï¼Œå…¶ä¸­CèŒƒå›´ä¸º-1.5% ~ -0.25%ï¼Œä»¥0.25%ä¸ºçº§å·®']);
                wsAlgorithmData.push(['5. ä»·æ ¼è¯„å®¡å¾—åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·']);
                wsAlgorithmData.push(['']);
                wsAlgorithmData.push(['è®¡ç®—å…¬å¼']);
                wsAlgorithmData.push(['ä»·æ ¼è¯„å®¡å¾—åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·']);
                wsAlgorithmData.push(['å½“æŠ•æ ‡ä»· â‰¥ åŸºå‡†ä»·ï¼Œn=2.0ï¼›å½“æŠ•æ ‡ä»· < åŸºå‡†ä»·ï¼Œn=0']);
            } else {
                wsAlgorithmData.push(['åŒºé—´ä¸‹é™ç³»æ•°b:', document.getElementById('intervalLower').value + '%']);
                wsAlgorithmData.push(['åŒºé—´ä¸Šé™ç³»æ•°c:', '+' + document.getElementById('intervalUpper').value + '%']);
                wsAlgorithmData.push(['è¯„æ ‡ä»· â‰¥ åŸºå‡†ä»·æ—¶çš„ç³»æ•° n1:', document.getElementById('n1').value]);
                wsAlgorithmData.push(['è¯„æ ‡ä»· < åŸºå‡†ä»·æ—¶çš„ç³»æ•° n2:', document.getElementById('n2').value]);
                wsAlgorithmData.push(['']);
                wsAlgorithmData.push(['åŒºé—´å¤åˆå¹³å‡ä»·æ³•è¯´æ˜']);
                wsAlgorithmData.push(['æ ¹æ®åŒºé—´å¤åˆå¹³å‡ä»·æ³•è®¡ç®—ä»·æ ¼è¯„å®¡å¾—åˆ†ï¼š']);
                wsAlgorithmData.push(['1. è®¡ç®—è¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººï¼ˆMä¸ªï¼‰è¯„æ ‡ä»·ç®—æœ¯å¹³å‡å€¼ A1']);
                wsAlgorithmData.push(['2. åˆ¤å®šMä¸ªè¯„æ ‡ä»·æ˜¯å¦å‡åœ¨å¹³å‡å€¼åŒºé—´[A1Ã—(1+b), A1Ã—(1+c)]èŒƒå›´å¤–']);
                wsAlgorithmData.push(['3. å¦‚æœå‡åœ¨èŒƒå›´å¤–ï¼Œåˆ™è®¡ç®—æ‰€æœ‰è¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººè¯„æ ‡ä»·çš„ç®—æœ¯å¹³å‡å€¼ä¸æ‰€æœ‰è¯„æ ‡ä»·æœ€å°å€¼ä¸¤è€…çš„å¹³å‡å€¼ï¼Œä¸ºåŸºå‡†ä»·']);
                wsAlgorithmData.push(['4. å¦‚æœå­˜åœ¨è¯„æ ‡ä»·åœ¨åŒºé—´èŒƒå›´å†…ï¼Œåˆ™è®¡ç®—åŒºé—´å†…çš„æŠ•æ ‡äººï¼ˆNä¸ªï¼‰è¯„æ ‡ä»·ç®—æœ¯å¹³å‡å€¼ï¼Œä¸ºåŸºå‡†ä»·']);
                wsAlgorithmData.push(['5. è®¡ç®—ä»·æ ¼åˆ†ï¼šä»·æ ¼åˆ†=100-100Ã—nÃ—|æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»·-åŸºå‡†ä»·|/åŸºå‡†ä»·']);
                wsAlgorithmData.push(['6. åˆ¤æ–­ä»·æ ¼åˆ†æ˜¯å¦å°äº0ï¼Œå¦‚æœå°äº0ï¼Œåˆ™ä»·æ ¼åˆ†ä¸º0']);
                wsAlgorithmData.push(['']);
                wsAlgorithmData.push(['è®¡ç®—å…¬å¼']);
                wsAlgorithmData.push(['ä»·æ ¼åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·']);
                wsAlgorithmData.push(['å½“è¯„æ ‡ä»· â‰¥ åŸºå‡†ä»·ï¼Œn=n1ï¼›å½“è¯„æ ‡ä»· < åŸºå‡†ä»·ï¼Œn=n2']);
            }
            
            wsAlgorithmData.push(['']);
            wsAlgorithmData.push(['ç‰¹åˆ«è¯´æ˜']);
            wsAlgorithmData.push(['1. æ‰€æœ‰åŒ…å«"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"çš„è¡Œå·²ç”¨çº¢è‰²é«˜äº®æ ‡è®°']);
            wsAlgorithmData.push(['2. å„åŒ…è¯¦ç»†æ•°æ®è§å¯¹åº”åŒ…å·çš„å·¥ä½œè¡¨']);
            wsAlgorithmData.push(['3. æœ¬è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå®é™…è¯„å®¡ç»“æœä»¥æ‹›æ ‡å§”å‘˜ä¼šæœ€ç»ˆç¡®è®¤ä¸ºå‡†']);
            
            const wsAlgorithm = XLSX.utils.aoa_to_sheet(wsAlgorithmData);
            XLSX.utils.book_append_sheet(wb, wsAlgorithm, "ç®—æ³•è¯´æ˜");
            
            // 2. æŠ•æ ‡äººè·å¾—æ»¡åˆ†åŒ…æ•°é‡ç»Ÿè®¡
            const wsFullScoreStatsData = [
                ['æŠ•æ ‡äººè·å¾—æ»¡åˆ†åŒ…æ•°é‡ç»Ÿè®¡ï¼ˆæŒ‰æ•°é‡ä»å¤šåˆ°å°‘æ’åˆ—ï¼‰'],
                ['ä½¿ç”¨ç®—æ³•:', algorithmName],
                ['è®¡ç®—æ—¶é—´:', new Date().toLocaleString('zh-CN')],
                [''],
                ['æ’å', 'æŠ•æ ‡äººåç§°', 'è·å¾—æ»¡åˆ†åŒ…æ•°é‡', 'æ»¡åˆ†åŒ…åˆ—è¡¨']
            ];
            
            // å°†æŠ•æ ‡äººæ»¡åˆ†ç»Ÿè®¡è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
            const bidderStatsArray = Object.entries(calculationResults.bidderFullScoreStats)
                .map(([name, stats]) => ({
                    name,
                    count: stats.count,
                    packages: stats.packages
                }))
                .sort((a, b) => b.count - a.count);
            
            // æ·»åŠ æŠ•æ ‡äººæ»¡åˆ†åŒ…ç»Ÿè®¡
            bidderStatsArray.forEach((bidder, index) => {
                wsFullScoreStatsData.push([
                    index + 1,
                    bidder.name,
                    bidder.count,
                    bidder.packages.join(', ')
                ]);
            });
            
            const wsFullScoreStats = XLSX.utils.aoa_to_sheet(wsFullScoreStatsData);
            XLSX.utils.book_append_sheet(wb, wsFullScoreStats, "æ»¡åˆ†åŒ…ç»Ÿè®¡");
            
            // 3. å„åŒ…è®¡ç®—ç»“æœæ±‡æ€»
            const wsPackageSummaryData = [
                ['å„åŒ…è®¡ç®—ç»“æœæ±‡æ€»'],
                ['ä½¿ç”¨ç®—æ³•:', algorithmName]
            ];
            
            if (algorithm === 'arithmetic') {
                wsPackageSummaryData.push(['åŒ…å·', 'åŒºåŸŸ', 'M2æŠ•æ ‡äººæ•°', 'å¹³å‡ä»·A1(ä¸‡å…ƒ)', 'M3æŠ•æ ‡äººæ•°', 'å¹³å‡ä»·A2(ä¸‡å…ƒ)', 'åŸºå‡†ä»·A3(ä¸‡å…ƒ)', 'æ»¡åˆ†æŠ•æ ‡äººæ•°']);
            } else {
                wsPackageSummaryData.push(['åŒ…å·', 'åŒºåŸŸ', 'åˆæ ¼æŠ•æ ‡äººæ•°', 'å¹³å‡ä»·A1(ä¸‡å…ƒ)', 'åŒºé—´å†…äººæ•°', 'åŸºå‡†ä»·(ä¸‡å…ƒ)', 'æ»¡åˆ†æŠ•æ ‡äººæ•°']);
            }
            
            // æ·»åŠ å„åŒ…æ±‡æ€»æ•°æ®
            Object.keys(calculationResults.packages).forEach(packageNo => {
                const packageData = calculationResults.packages[packageNo];
                const region = calculationResults.allBidders.find(b => b.package === packageNo)?.region || '';
                const fullScoreCount = packageData.bidders.filter(b => b.qualified && b.score === 100).length;
                
                if (algorithm === 'arithmetic') {
                    wsPackageSummaryData.push([
                        packageNo,
                        region,
                        packageData.m2Count,
                        parseFloat(packageData.a1),
                        packageData.m3Count,
                        parseFloat(packageData.a2),
                        parseFloat(packageData.a3),
                        fullScoreCount
                    ]);
                } else {
                    wsPackageSummaryData.push([
                        packageNo,
                        region,
                        packageData.qualifiedCount,
                        parseFloat(packageData.a1),
                        packageData.intervalCount,
                        parseFloat(packageData.benchmark),
                        fullScoreCount
                    ]);
                }
            });
            
            const wsPackageSummary = XLSX.utils.aoa_to_sheet(wsPackageSummaryData);
            XLSX.utils.book_append_sheet(wb, wsPackageSummary, "å„åŒ…æ±‡æ€»");
            
            // 4. æ»¡åˆ†æŠ•æ ‡äººæ˜ç»†
            const wsFullScoreDetailData = [
                ['æ»¡åˆ†æŠ•æ ‡äººæ˜ç»†'],
                ['ä½¿ç”¨ç®—æ³•:', algorithmName],
                ['åºå·', 'åŒ…å·', 'åŒºåŸŸ', 'æŠ•æ ‡äººåç§°', 'è¯„æ ‡æ€»ä»·(ä¸‡å…ƒ)', 'é€šè¿‡åˆæ­¥è¯„å®¡', 'å‚ä¸åŸºå‡†ä»·è®¡ç®—', 'ä»·æ ¼å¾—åˆ†']
            ];
            
            // æ”¶é›†æ‰€æœ‰æ»¡åˆ†æŠ•æ ‡äºº
            let allFullScoreBidders = [];
            Object.keys(calculationResults.packages).forEach(packageNo => {
                const packageData = calculationResults.packages[packageNo];
                const fullScoreBidders = packageData.bidders
                    .filter(b => b.qualified && b.score === 100)
                    .map(b => ({
                        package: packageNo,
                        region: calculationResults.allBidders.find(bid => bid.package === packageNo && bid.name === b.name)?.region || '',
                        name: b.name,
                        price: b.price,
                        qualified: b.qualified,
                        participates: b.participates,
                        score: b.score
                    }));
                
                allFullScoreBidders = allFullScoreBidders.concat(fullScoreBidders);
            });
            
            // æŒ‰åŒ…å·æ’åºï¼Œå†æŒ‰æŠ•æ ‡äººåç§°æ’åº
            allFullScoreBidders.sort((a, b) => {
                if (a.package !== b.package) {
                    return a.package.localeCompare(b.package, undefined, {numeric: true});
                }
                return a.name.localeCompare(b.name);
            });
            
            // æ·»åŠ æ»¡åˆ†æŠ•æ ‡äººæ•°æ®
            allFullScoreBidders.forEach((bidder, index) => {
                wsFullScoreDetailData.push([
                    index + 1,
                    bidder.package,
                    bidder.region,
                    bidder.name,
                    bidder.price,
                    bidder.qualified ? 'æ˜¯' : 'å¦',
                    bidder.participates ? 'æ˜¯' : 'å¦',
                    bidder.score
                ]);
            });
            
            const wsFullScoreDetail = XLSX.utils.aoa_to_sheet(wsFullScoreDetailData);
            XLSX.utils.book_append_sheet(wb, wsFullScoreDetail, "æ»¡åˆ†æŠ•æ ‡äººæ˜ç»†");
            
            // 5. æ¯ä¸ªåŒ…çš„è¯¦ç»†æŠ•æ ‡æ•°æ®ï¼ˆæ¯ä¸ªåŒ…ä¸€ä¸ªå·¥ä½œè¡¨ï¼‰
            // è·å–æ‰€æœ‰åŒ…å·å¹¶æŒ‰å­—æ¯/æ•°å­—é¡ºåºæ’åº
            const allPackageNos = Object.keys(calculationResults.packages).sort();
            
            // éå†æ¯ä¸ªåŒ…
            allPackageNos.forEach(packageNo => {
                const packageData = calculationResults.packages[packageNo];
                const region = calculationResults.allBidders.find(b => b.package === packageNo)?.region || '';
                
                // åˆ›å»ºåŒ…çš„æ•°æ®è¡¨
                const wsPackageDetailData = [
                    [`${packageNo} - ${region} è¯¦ç»†æŠ•æ ‡æ•°æ®`],
                    ['ä½¿ç”¨ç®—æ³•:', algorithmName],
                    ['åŒ…å†…æ’å', 'åŒ…å·', 'åŒºåŸŸ', 'æŠ•æ ‡äººåç§°', 'è¯„æ ‡æ€»ä»·(ä¸‡å…ƒ)', 'é€šè¿‡åˆæ­¥è¯„å®¡', 'å‚ä¸åŸºå‡†ä»·è®¡ç®—', 'ä»·æ ¼å¾—åˆ†']
                ];
                
                // è·å–å½“å‰åŒ…çš„æŠ•æ ‡äººæ•°æ®ï¼Œå¹¶æŒ‰å¾—åˆ†é™åºæ’åº
                const packageBidders = packageData.bidders
                    .sort((a, b) => b.score - a.score);
                
                // æ˜¾ç¤ºå½“å‰åŒ…çš„æŠ•æ ‡äºº
                packageBidders.forEach((bidder, index) => {
                    wsPackageDetailData.push([
                        index + 1,
                        packageNo,
                        calculationResults.allBidders.find(b => b.package === packageNo && b.name === bidder.name)?.region || '',
                        bidder.name,
                        bidder.price,
                        bidder.qualified ? 'æ˜¯' : 'å¦',
                        bidder.participates ? 'æ˜¯' : 'å¦',
                        bidder.score
                    ]);
                });
                
                // æ·»åŠ åŒ…ç»Ÿè®¡ä¿¡æ¯
                const fullScoreCount = packageBidders.filter(b => b.qualified && b.score === 100).length;
                wsPackageDetailData.push(['']);
                wsPackageDetailData.push(['åŒ…ç»Ÿè®¡ä¿¡æ¯']);
                
                if (algorithm === 'arithmetic') {
                    wsPackageDetailData.push(['M2æŠ•æ ‡äººæ•°:', packageData.m2Count]);
                    wsPackageDetailData.push(['å¹³å‡ä»·A1(ä¸‡å…ƒ):', parseFloat(packageData.a1)]);
                    wsPackageDetailData.push(['M3æŠ•æ ‡äººæ•°:', packageData.m3Count]);
                    wsPackageDetailData.push(['å¹³å‡ä»·A2(ä¸‡å…ƒ):', parseFloat(packageData.a2)]);
                    wsPackageDetailData.push(['åŸºå‡†ä»·A3(ä¸‡å…ƒ):', parseFloat(packageData.a3)]);
                } else {
                    wsPackageDetailData.push(['åˆæ ¼æŠ•æ ‡äººæ•°:', packageData.qualifiedCount]);
                    wsPackageDetailData.push(['å¹³å‡ä»·A1(ä¸‡å…ƒ):', parseFloat(packageData.a1)]);
                    wsPackageDetailData.push(['åŒºé—´å†…æŠ•æ ‡äººæ•°:', packageData.intervalCount]);
                    wsPackageDetailData.push(['åŒºé—´ä¸‹é™ç³»æ•°b:', packageData.lower]);
                    wsPackageDetailData.push(['åŒºé—´ä¸Šé™ç³»æ•°c:', packageData.upper]);
                    wsPackageDetailData.push(['åŸºå‡†ä»·(ä¸‡å…ƒ):', parseFloat(packageData.benchmark)]);
                }
                
                wsPackageDetailData.push(['æ»¡åˆ†æŠ•æ ‡äººæ•°:', fullScoreCount]);
                
                // æ¸…ç†å·¥ä½œè¡¨åç§°ï¼ˆExcelå·¥ä½œè¡¨åç§°ä¸èƒ½è¶…è¿‡31ä¸ªå­—ç¬¦ï¼Œä¸èƒ½åŒ…å«ç‰¹æ®Šå­—ç¬¦ï¼‰
                let sheetName = packageNo.replace(/[\/\\\?\*\[\]:]/g, '_');
                if (sheetName.length > 31) {
                    sheetName = sheetName.substring(0, 31);
                }
                if (sheetName === '') {
                    sheetName = 'æœªå‘½ååŒ…';
                }
                
                const wsPackageDetail = XLSX.utils.aoa_to_sheet(wsPackageDetailData);
                XLSX.utils.book_append_sheet(wb, wsPackageDetail, sheetName);
            });
            
            // è®¾ç½®åˆ—å®½
            const algorithmCols = [
                {wch: 30}, {wch: 50}
            ];
            wsAlgorithm['!cols'] = algorithmCols;
            
            const fullScoreStatsCols = [
                {wch: 8}, {wch: 30}, {wch: 18}, {wch: 30}
            ];
            wsFullScoreStats['!cols'] = fullScoreStatsCols;
            
            const packageSummaryCols = algorithm === 'arithmetic' ? [
                {wch: 10}, {wch: 25}, {wch: 12}, {wch: 15}, {wch: 12}, {wch: 15}, {wch: 15}, {wch: 15}
            ] : [
                {wch: 10}, {wch: 25}, {wch: 12}, {wch: 15}, {wch: 12}, {wch: 15}, {wch: 15}
            ];
            wsPackageSummary['!cols'] = packageSummaryCols;
            
            const fullScoreDetailCols = [
                {wch: 8}, {wch: 10}, {wch: 25}, {wch: 30}, {wch: 15}, {wch: 15}, {wch: 20}, {wch: 12}
            ];
            wsFullScoreDetail['!cols'] = fullScoreDetailCols;
            
            // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
            const algorithmShort = algorithm === 'arithmetic' ? 'ç®—æœ¯æ³•' : 'åŒºé—´æ³•';
            const fileName = `æŠ•æ ‡ä»·æ ¼è¯„åˆ†æ±‡æ€»_${algorithmShort}_${new Date().toISOString().slice(0, 10)}_${new Date().getTime()}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            // æç¤ºç”¨æˆ·
            alert(`å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¿å­˜ä¸º: ${fileName}\n\nå·¥ä½œç°¿åŒ…å«ä»¥ä¸‹å·¥ä½œè¡¨ï¼š\n1. ç®—æ³•è¯´æ˜\n2. æ»¡åˆ†åŒ…ç»Ÿè®¡\n3. å„åŒ…æ±‡æ€»\n4. æ»¡åˆ†æŠ•æ ‡äººæ˜ç»†\n5. å„åŒ…è¯¦ç»†æ•°æ®ï¼ˆæ¯ä¸ªåŒ…ä¸€ä¸ªå·¥ä½œè¡¨ï¼‰\n\næ³¨ï¼šåœ¨HTMLé¡µé¢ä¸­"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"å·²ç”¨çº¢è‰²é«˜äº®æ˜¾ç¤ºï¼Œä½†åœ¨å¯¼å‡ºçš„Excelä¸­éœ€è¦æ‰‹åŠ¨è®¾ç½®æ¡ä»¶æ ¼å¼ã€‚`);
        }
        
        // å¯¼å‡ºPDFæŠ¥å‘Š
        async function exportPDFReport() {
            // å¦‚æœæ²¡æœ‰è®¡ç®—ç»“æœï¼Œå…ˆè®¡ç®—
            if (Object.keys(calculationResults.packages).length === 0) {
                const confirmCalc = confirm('å°šæœªè®¡ç®—ä»·æ ¼å¾—åˆ†ï¼Œæ˜¯å¦å…ˆè¿›è¡Œè®¡ç®—ï¼Ÿ');
                if (confirmCalc) {
                    calculateAllPackages();
                } else {
                    return;
                }
            }
            
            // æ˜¾ç¤ºåŠ è½½æç¤º
            const pdfLoading = document.getElementById('pdfLoading');
            const pdfProgress = document.getElementById('pdfProgress');
            pdfLoading.classList.remove('hidden');
            pdfProgress.textContent = 'å‡†å¤‡ç”ŸæˆPDF...';
            
            try {
                // åˆ›å»ºjsPDFå®ä¾‹ï¼Œä½¿ç”¨æ¨ªå‘A4çº¸å¼ 
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('l', 'mm', 'a4'); // æ¨ªå‘ï¼ŒA4çº¸
                
                // è·å–å½“å‰æ—¶é—´å’Œç®—æ³•ä¿¡æ¯
                const currentTime = new Date().toLocaleString('zh-CN');
                const algorithm = calculationResults.currentAlgorithm;
                const algorithmName = algorithm === 'arithmetic' ? 'ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•' : 'åŒºé—´å¤åˆå¹³å‡ä»·æ³•';
                
                // è·å–ç®—æ³•å‚æ•°
                let algorithmParams = '';
                if (algorithm === 'arithmetic') {
                    const floatCoefficient = document.getElementById('floatCoefficient').value + '%';
                    algorithmParams = `æµ®åŠ¨ç³»æ•°C: ${floatCoefficient}`;
                } else {
                    const lower = document.getElementById('intervalLower').value + '%';
                    const upper = '+' + document.getElementById('intervalUpper').value + '%';
                    const n1 = document.getElementById('n1').value;
                    const n2 = document.getElementById('n2').value;
                    algorithmParams = `åŒºé—´å‚æ•°: b=${lower}, c=${upper}, n1=${n1}, n2=${n2}`;
                }
                
                // è·å–å¯¼å‡ºé€‰é¡¹
                const includeSummary = document.getElementById('includeSummary').checked;
                const includePackageDetails = document.getElementById('includePackageDetails').checked;
                const includeAllBidders = document.getElementById('includeAllBidders').checked;
                
                // è·å–æ–‡ä»¶åæˆ–ä½¿ç”¨é»˜è®¤æ ‡é¢˜
                const reportTitle = currentFileName || 'æŠ•æ ‡ä»·æ ¼è¯„åˆ†æ±‡æ€»æŠ¥å‘Š';
                
                // 1. åˆ›å»ºå°é¢é¡µ
                pdfProgress.textContent = 'ç”Ÿæˆå°é¢é¡µ...';
                
                let coverMethodDescription = '';
                if (algorithm === 'arithmetic') {
                    coverMethodDescription = `
                        <h3 style="color: #2c3e50; font-size: 18px; margin-bottom: 12px; text-align: left;">ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•è¯´æ˜</h3>
                        <p style="color: #333; font-size: 14px; line-height: 1.6; text-align: left; margin-bottom: 16px;">
                            æ ¹æ®æ‹›æ ‡æ–‡ä»¶è§„å®šï¼Œå¯¼çº¿åˆ†æ ‡é‡‡ç”¨<strong>ç®—æœ¯å¹³å‡å€¼æµ®åŠ¨æ³•</strong>è®¡ç®—ä»·æ ¼è¯„å®¡å¾—åˆ†ï¼š
                        </p>
                        <ol style="color: #333; font-size: 13px; line-height: 1.6; text-align: left; margin-left: 18px; margin-bottom: 24px;">
                            <li>è®¡ç®—M2æŠ•æ ‡äººï¼ˆé€šè¿‡æ‰€æœ‰åˆæ­¥è¯„å®¡çš„åˆæ ¼æŠ•æ ‡äººï¼‰è¯„æ ‡ä»·çš„å¹³å‡å€¼A1</li>
                            <li>æ’é™¤M2ä¸­ä½äºA1å€¼30%ï¼ˆä¸å«30%ï¼‰çš„æŠ¥ä»·ï¼Œå‰©ä½™M3ä¸ªæŠ•æ ‡äººå‚ä¸åŸºå‡†ä»·è®¡ç®—</li>
                            <li>è®¡ç®—M3ä¸ªæŠ•æ ‡äººè¯„æ ‡ä»·çš„å¹³å‡å€¼A2</li>
                            <li>è®¡ç®—åŸºå‡†ä»·A3 = A2 Ã— (1 + æµ®åŠ¨ç³»æ•°C)ï¼Œå…¶ä¸­CèŒƒå›´ä¸º-1.5% ~ -0.25%ï¼Œä»¥0.25%ä¸ºçº§å·®</li>
                            <li>ä»·æ ¼è¯„å®¡å¾—åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·</li>
                        </ol>
                        <div style="background-color: #f1f8ff; padding: 15px; border-radius: 6px; border-left: 3px solid #3498db; margin: 16px 0; font-family: 'Courier New', monospace; font-size: 13px;">
                            <div>ä»·æ ¼è¯„å®¡å¾—åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·</div>
                            <div>å½“æŠ•æ ‡ä»· â‰¥ åŸºå‡†ä»·ï¼Œn=2.0ï¼›å½“æŠ•æ ‡ä»· ï¼œ åŸºå‡†ä»·ï¼Œn=0</div>
                        </div>
                    `;
                } else {
                    coverMethodDescription = `
                        <h3 style="color: #2c3e50; font-size: 18px; margin-bottom: 12px; text-align: left;">åŒºé—´å¤åˆå¹³å‡ä»·æ³•è¯´æ˜</h3>
                        <p style="color: #333; font-size: 14px; line-height: 1.6; text-align: left; margin-bottom: 16px;">
                            æ ¹æ®<strong>åŒºé—´å¤åˆå¹³å‡ä»·æ³•</strong>è®¡ç®—ä»·æ ¼è¯„å®¡å¾—åˆ†ï¼š
                        </p>
                        <ol style="color: #333; font-size: 13px; line-height: 1.6; text-align: left; margin-left: 18px; margin-bottom: 24px;">
                            <li>è®¡ç®—è¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººï¼ˆMä¸ªï¼‰è¯„æ ‡ä»·ç®—æœ¯å¹³å‡å€¼ A1</li>
                            <li>åˆ¤å®šMä¸ªè¯„æ ‡ä»·æ˜¯å¦å‡åœ¨å¹³å‡å€¼åŒºé—´[A1Ã—(1+b), A1Ã—(1+c)]èŒƒå›´å¤–</li>
                            <li>å¦‚æœå‡åœ¨èŒƒå›´å¤–ï¼Œåˆ™è®¡ç®—æ‰€æœ‰è¿›å…¥è¯¦è¯„çš„æŠ•æ ‡äººè¯„æ ‡ä»·çš„ç®—æœ¯å¹³å‡å€¼ä¸æ‰€æœ‰è¯„æ ‡ä»·æœ€å°å€¼ä¸¤è€…çš„å¹³å‡å€¼ï¼Œä¸ºåŸºå‡†ä»·</li>
                            <li>å¦‚æœå­˜åœ¨è¯„æ ‡ä»·åœ¨åŒºé—´èŒƒå›´å†…ï¼Œåˆ™è®¡ç®—åŒºé—´å†…çš„æŠ•æ ‡äººï¼ˆNä¸ªï¼‰è¯„æ ‡ä»·ç®—æœ¯å¹³å‡å€¼ï¼Œä¸ºåŸºå‡†ä»·</li>
                            <li>è®¡ç®—ä»·æ ¼åˆ†ï¼šä»·æ ¼åˆ†=100-100Ã—nÃ—|æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»·-åŸºå‡†ä»·|/åŸºå‡†ä»·</li>
                            <li>åˆ¤æ–­ä»·æ ¼åˆ†æ˜¯å¦å°äº0ï¼Œå¦‚æœå°äº0ï¼Œåˆ™ä»·æ ¼åˆ†ä¸º0</li>
                        </ol>
                        <div style="background-color: #f1f8ff; padding: 15px; border-radius: 6px; border-left: 3px solid #3498db; margin: 16px 0; font-family: 'Courier New', monospace; font-size: 13px;">
                            <div>ä»·æ ¼åˆ† = 100 - 100 Ã— n Ã— |æŠ•æ ‡äººçš„è¯„æ ‡æ€»ä»· - åŸºå‡†ä»·| / åŸºå‡†ä»·</div>
                            <div>å½“è¯„æ ‡ä»· â‰¥ åŸºå‡†ä»·ï¼Œn=n1ï¼›å½“è¯„æ ‡ä»· < åŸºå‡†ä»·ï¼Œn=n2</div>
                        </div>
                    `;
                }
                
                const coverHTML = `
                    <div class="pdf-cover">
                        <div style="text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: center;">
                            <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 16px; font-weight: bold;">${reportTitle}</h1>
                            <h2 style="color: #3498db; font-size: 20px; margin-bottom: 32px;">${algorithmName} - æŠ•æ ‡ä»·æ ¼è¯„åˆ†è®¡ç®—å…¬å¼è¯´æ˜</h2>
                            
                            <div style="width: 80%; margin: 0 auto; border-top: 2px solid #3498db; padding-top: 24px;">
                                ${coverMethodDescription}
                                
                                <div style="margin-top: 24px; text-align: left;">
                                    <p style="color: #333; font-size: 12px;"><strong>è®¡ç®—æ—¶é—´:</strong> ${currentTime}</p>
                                    <p style="color: #333; font-size: 12px;"><strong>ä½¿ç”¨ç®—æ³•:</strong> ${algorithmName}</p>
                                    <p style="color: #333; font-size: 12px;"><strong>ç®—æ³•å‚æ•°:</strong> ${algorithmParams}</p>
                                </div>
                                
                                <div style="margin-top: 32px; padding: 16px; background-color: #fff8e1; border-radius: 6px; text-align: left;">
                                    <h4 style="color: #f39c12; margin-top: 0; font-size: 14px;">ç‰¹åˆ«è¯´æ˜</h4>
                                    <p style="color: #333; font-size: 12px; margin: 4px 0;">1. æ‰€æœ‰åŒ…å«"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"çš„è¡Œå·²ç”¨çº¢è‰²é«˜äº®æ ‡è®°</p>
                                    <p style="color: #333; font-size: 12px; margin: 4px 0;">2. æœ¬è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå®é™…è¯„å®¡ç»“æœä»¥æ‹›æ ‡å§”å‘˜ä¼šæœ€ç»ˆç¡®è®¤ä¸ºå‡†</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                const pdfTempContainer = document.getElementById('pdfTempContainer');
                pdfTempContainer.innerHTML = coverHTML;
                pdfTempContainer.style.visibility = 'visible';
                
                // å°†å°é¢è½¬æ¢ä¸ºå›¾ç‰‡å¹¶æ·»åŠ åˆ°PDF
                await convertToPDF(doc, pdfTempContainer, true);
                pdfTempContainer.innerHTML = '';
                
                // 2. æŠ•æ ‡äººè·å¾—æ»¡åˆ†åŒ…æ•°é‡ç»Ÿè®¡
                if (includeSummary) {
                    pdfProgress.textContent = 'ç”ŸæˆæŠ•æ ‡äººç»Ÿè®¡é¡µ...';
                    
                    // å°†æŠ•æ ‡äººæ»¡åˆ†ç»Ÿè®¡è½¬æ¢ä¸ºæ•°ç»„å¹¶æ’åº
                    const bidderStatsArray = Object.entries(calculationResults.bidderFullScoreStats)
                        .map(([name, stats]) => ({
                            name,
                            count: stats.count,
                            packages: stats.packages
                        }))
                        .sort((a, b) => b.count - a.count);
                    
                    // è®¡ç®—åŒ…æ€»æ•°
                    const packageCount = Object.keys(calculationResults.packages).length;
                    
                    const statsHTML = `
                        <div style="width: 1100px; padding: 32px; background-color: white; box-sizing: border-box;">
                            <h1 style="color: #2c3e50; font-size: 24px; margin-bottom: 24px; text-align: center;">æŠ•æ ‡äººè·å¾—æ»¡åˆ†åŒ…æ•°é‡ç»Ÿè®¡</h1>
                            
                            <div style="margin-bottom: 16px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                    <div style="font-size: 14px; color: #333;"><strong>ä½¿ç”¨ç®—æ³•:</strong> ${algorithmName}</div>
                                    <div style="font-size: 14px; color: #333;"><strong>è®¡ç®—æ—¶é—´:</strong> ${currentTime}</div>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <div style="font-size: 14px; color: #333;"><strong>æ€»åŒ…æ•°:</strong> ${packageCount}ä¸ª</div>
                                    <div style="font-size: 14px; color: #333;"><strong>æ€»æŠ•æ ‡äººæ•°:</strong> ${calculationResults.allBidders.length}ä¸ª</div>
                                </div>
                            </div>
                            
                            <table style="width: 100%; border-collapse: collapse; margin-top: 16px; border: 1px solid #ddd; font-size: 12px;">
                                <thead>
                                    <tr style="background-color: #2c3e50; color: white;">
                                        <th style="padding: 10px; border: 1px solid #ddd; text-align: center; width: 15%;">æ’å</th>
                                        <th style="padding: 10px; border: 1px solid #ddd; text-align: center; width: 40%;">æŠ•æ ‡äººåç§°</th>
                                        <th style="padding: 10px; border: 1px solid #ddd; text-align: center; width: 20%;">è·å¾—æ»¡åˆ†åŒ…æ•°é‡</th>
                                        <th style="padding: 10px; border: 1px solid #ddd; text-align: center; width: 25%;">æ»¡åˆ†åŒ…åˆ—è¡¨</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${bidderStatsArray.map((bidder, index) => {
                                        // æ£€æŸ¥æ˜¯å¦æ˜¯"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"ï¼Œå¦‚æœæ˜¯åˆ™çº¢è‰²é«˜äº®
                                        const isSpecial = bidder.name.includes('èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸');
                                        const rowStyle = isSpecial ? 'background-color: #ffcccc !important; font-weight: bold; color: #c0392b;' : '';
                                        
                                        return `
                                            <tr style="${rowStyle}">
                                                <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">${index + 1}</td>
                                                <td style="padding: 8px; border: 1px solid #ddd; text-align: left;">${bidder.name}</td>
                                                <td style="padding: 8px; border: 1px solid #ddd; text-align: center; font-weight: bold;">${bidder.count} ä¸ª</td>
                                                <td style="padding: 8px; border: 1px solid #ddd; text-align: left;">${bidder.packages.join(', ')}</td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                            
                            <div style="margin-top: 24px; padding: 12px; background-color: #f8f9fa; border-radius: 4px; border-left: 3px solid #3498db; font-size: 12px;">
                                <p style="margin: 0; color: #333;"><strong>è¯´æ˜ï¼š</strong>æœ¬è¡¨æŒ‰æŠ•æ ‡äººè·å¾—æ»¡åˆ†åŒ…æ•°é‡ä»å¤šåˆ°å°‘æ’åºï¼Œå±•ç¤ºäº†å„æŠ•æ ‡äººåœ¨æœ¬æ¬¡æ‹›æ ‡ä¸­çš„è¡¨ç°ã€‚</p>
                            </div>
                        </div>
                    `;
                    
                    pdfTempContainer.innerHTML = statsHTML;
                    await convertToPDF(doc, pdfTempContainer);
                    pdfTempContainer.innerHTML = '';
                }
                
                // 3. å„åŒ…è®¡ç®—ç»“æœæ±‡æ€»
                if (includePackageDetails) {
                    pdfProgress.textContent = 'ç”Ÿæˆå„åŒ…æ±‡æ€»é¡µ...';
                    
                    let packageSummaryHTML = '';
                    if (algorithm === 'arithmetic') {
                        packageSummaryHTML = `
                            <div style="width: 1100px; padding: 32px; background-color: white; box-sizing: border-box; font-size: 12px;">
                                <h1 style="color: #2c3e50; font-size: 24px; margin-bottom: 24px; text-align: center;">å„åŒ…è®¡ç®—ç»“æœæ±‡æ€»</h1>
                                
                                <div style="margin-bottom: 16px; display: flex; justify-content: space-between;">
                                    <div style="color: #333;"><strong>ä½¿ç”¨ç®—æ³•:</strong> ${algorithmName}</div>
                                    <div style="color: #333;"><strong>æµ®åŠ¨ç³»æ•°C:</strong> ${document.getElementById('floatCoefficient').value}%</div>
                                </div>
                                
                                <table style="width: 100%; border-collapse: collapse; margin-top: 16px; border: 1px solid #ddd; font-size: 11px;">
                                    <thead>
                                        <tr style="background-color: #2c3e50; color: white;">
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åŒ…å·</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åŒºåŸŸ</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">M2æŠ•æ ‡äººæ•°</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">å¹³å‡ä»·A1(ä¸‡å…ƒ)</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">M3æŠ•æ ‡äººæ•°</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">å¹³å‡ä»·A2(ä¸‡å…ƒ)</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åŸºå‡†ä»·A3(ä¸‡å…ƒ)</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">æ»¡åˆ†æŠ•æ ‡äººæ•°</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Object.keys(calculationResults.packages).map(packageNo => {
                                            const packageData = calculationResults.packages[packageNo];
                                            const region = calculationResults.allBidders.find(b => b.package === packageNo)?.region || '';
                                            const fullScoreCount = packageData.bidders.filter(b => b.qualified && b.score === 100).length;
                                            
                                            return `
                                                <tr>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageNo}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: left;">${region}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageData.m2Count}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageData.a1}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageData.m3Count}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageData.a2}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center; background-color: #fffacd; font-weight: bold;">${packageData.a3}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${fullScoreCount}</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    } else {
                        packageSummaryHTML = `
                            <div style="width: 1100px; padding: 32px; background-color: white; box-sizing: border-box; font-size: 12px;">
                                <h1 style="color: #2c3e50; font-size: 24px; margin-bottom: 24px; text-align: center;">å„åŒ…è®¡ç®—ç»“æœæ±‡æ€»</h1>
                                
                                <div style="margin-bottom: 16px;">
                                    <div style="display: flex; justify-content: space-between;">
                                        <div style="color: #333;"><strong>ä½¿ç”¨ç®—æ³•:</strong> ${algorithmName}</div>
                                        <div style="color: #333;"><strong>åŒºé—´å‚æ•°:</strong> b=${document.getElementById('intervalLower').value}%, c=+${document.getElementById('intervalUpper').value}%</div>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                                        <div style="color: #333;"><strong>ç³»æ•°:</strong> n1=${document.getElementById('n1').value}, n2=${document.getElementById('n2').value}</div>
                                    </div>
                                </div>
                                
                                <table style="width: 100%; border-collapse: collapse; margin-top: 16px; border: 1px solid #ddd; font-size: 11px;">
                                    <thead>
                                        <tr style="background-color: #2c3e50; color: white;">
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åŒ…å·</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åŒºåŸŸ</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åˆæ ¼æŠ•æ ‡äººæ•°</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">å¹³å‡ä»·A1(ä¸‡å…ƒ)</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åŒºé—´å†…äººæ•°</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">åŸºå‡†ä»·(ä¸‡å…ƒ)</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center;">æ»¡åˆ†æŠ•æ ‡äººæ•°</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${Object.keys(calculationResults.packages).map(packageNo => {
                                            const packageData = calculationResults.packages[packageNo];
                                            const region = calculationResults.allBidders.find(b => b.package === packageNo)?.region || '';
                                            const fullScoreCount = packageData.bidders.filter(b => b.qualified && b.score === 100).length;
                                            
                                            return `
                                                <tr>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageNo}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: left;">${region}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageData.qualifiedCount}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageData.a1}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${packageData.intervalCount}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center; background-color: #fffacd; font-weight: bold;">${packageData.benchmark}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${fullScoreCount}</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                    
                    pdfTempContainer.innerHTML = packageSummaryHTML;
                    await convertToPDF(doc, pdfTempContainer);
                    pdfTempContainer.innerHTML = '';
                }
                
                // 4. æ‰€æœ‰æŠ•æ ‡äººæ˜ç»†ï¼ˆå¦‚æœé€‰æ‹©åŒ…å«ï¼‰
                if (includeAllBidders) {
                    pdfProgress.textContent = 'ç”ŸæˆæŠ•æ ‡äººæ˜ç»†é¡µ...';
                    
                    // è·å–æ‰€æœ‰åŒ…å·å¹¶æŒ‰å­—æ¯/æ•°å­—é¡ºåºæ’åº
                    const allPackageNos = Object.keys(calculationResults.packages).sort();
                    
                    // åˆ†é¡µå¤„ç†æ¯ä¸ªåŒ…çš„æ•°æ®
                    for (let i = 0; i < allPackageNos.length; i++) {
                        const packageNo = allPackageNos[i];
                        const packageData = calculationResults.packages[packageNo];
                        const region = calculationResults.allBidders.find(b => b.package === packageNo)?.region || '';
                        
                        // è·å–å½“å‰åŒ…çš„æŠ•æ ‡äººæ•°æ®ï¼Œå¹¶æŒ‰å¾—åˆ†é™åºæ’åº
                        const packageBidders = packageData.bidders
                            .sort((a, b) => b.score - a.score);
                        
                        const biddersHTML = `
                            <div style="width: 1100px; padding: 32px; background-color: white; box-sizing: border-box; font-size: 12px;">
                                <h1 style="color: #2c3e50; font-size: 24px; margin-bottom: 16px; text-align: center;">${packageNo} - ${region}</h1>
                                <h2 style="color: #3498db; font-size: 18px; margin-bottom: 24px; text-align: center;">æŠ•æ ‡äººæ˜ç»†ï¼ˆæŒ‰å¾—åˆ†é™åºæ’åˆ—ï¼‰</h2>
                                
                                <table style="width: 100%; border-collapse: collapse; margin-top: 16px; border: 1px solid #ddd; font-size: 11px;">
                                    <thead>
                                        <tr style="background-color: #2c3e50; color: white;">
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 10%;">åŒ…å†…æ’å</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 30%;">æŠ•æ ‡äººåç§°</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 15%;">è¯„æ ‡æ€»ä»·(ä¸‡å…ƒ)</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 15%;">é€šè¿‡åˆæ­¥è¯„å®¡</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 20%;">å‚ä¸åŸºå‡†ä»·è®¡ç®—</th>
                                            <th style="padding: 8px; border: 1px solid #ddd; text-align: center; width: 10%;">ä»·æ ¼å¾—åˆ†</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${packageBidders.map((bidder, index) => {
                                            // æ£€æŸ¥æ˜¯å¦æ˜¯"èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸"ï¼Œå¦‚æœæ˜¯åˆ™çº¢è‰²é«˜äº®
                                            const isSpecial = bidder.name.includes('èˆªå¤©ç”µå·¥é›†å›¢æœ‰é™å…¬å¸');
                                            const rowStyle = isSpecial ? 'background-color: #ffcccc !important; font-weight: bold; color: #c0392b;' : '';
                                            
                                            // æ ¹æ®å¾—åˆ†è®¾ç½®ä¸åŒçš„æ ·å¼ç±»
                                            let scoreStyle = '';
                                            if (bidder.score === 100) {
                                                scoreStyle = 'background-color: #d4edda; color: #155724; font-weight: bold;';
                                            } else if (bidder.score >= 80) {
                                                scoreStyle = 'background-color: #d1ecf1; color: #0c5460;';
                                            } else if (bidder.score >= 60) {
                                                scoreStyle = 'background-color: #fff3cd; color: #856404;';
                                            } else if (bidder.score > 0) {
                                                scoreStyle = 'background-color: #f8d7da; color: #721c24;';
                                            } else {
                                                scoreStyle = 'background-color: #f5f5f5; color: #6c757d;';
                                            }
                                            
                                            return `
                                                <tr style="${rowStyle}">
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${index + 1}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: left;">${bidder.name}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: right;">${bidder.price.toFixed(2)}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${bidder.qualified ? 'æ˜¯' : 'å¦'}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center;">${bidder.participates ? 'æ˜¯' : 'å¦'}</td>
                                                    <td style="padding: 6px; border: 1px solid #ddd; text-align: center; ${scoreStyle}">${bidder.score}</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                                
                                <div style="margin-top: 24px; padding: 16px; background-color: #f8f9fa; border-radius: 4px; font-size: 11px;">
                                    <h3 style="color: #2c3e50; margin-top: 0; font-size: 16px;">åŒ…ç»Ÿè®¡ä¿¡æ¯</h3>
                                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 12px;">
                                        ${algorithm === 'arithmetic' ? `
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">M2æŠ•æ ‡äººæ•°</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.m2Count}ä¸ª</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">å¹³å‡ä»·A1</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.a1}ä¸‡å…ƒ</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">M3æŠ•æ ‡äººæ•°</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.m3Count}ä¸ª</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">å¹³å‡ä»·A2</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.a2}ä¸‡å…ƒ</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">æµ®åŠ¨ç³»æ•°C</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.c}</div>
                                            </div>
                                            <div style="background-color: #fffacd; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">åŸºå‡†ä»·A3</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.a3}ä¸‡å…ƒ</div>
                                            </div>
                                        ` : `
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">åˆæ ¼æŠ•æ ‡äººæ•°</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.qualifiedCount}ä¸ª</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">å¹³å‡ä»·A1</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.a1}ä¸‡å…ƒ</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">åŒºé—´å†…äººæ•°</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.intervalCount}ä¸ª</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">åŒºé—´ä¸‹é™ç³»æ•°b</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.lower}</div>
                                            </div>
                                            <div style="background-color: white; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">åŒºé—´ä¸Šé™ç³»æ•°c</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.upper}</div>
                                            </div>
                                            <div style="background-color: #fffacd; padding: 12px; border-radius: 4px; text-align: center; border: 1px solid #ddd;">
                                                <div style="font-size: 12px; color: #7f8c8d;">åŸºå‡†ä»·</div>
                                                <div style="font-size: 18px; font-weight: bold; color: #2c3e50;">${packageData.benchmark}ä¸‡å…ƒ</div>
                                            </div>
                                        `}
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        pdfTempContainer.innerHTML = biddersHTML;
                        await convertToPDF(doc, pdfTempContainer);
                        pdfTempContainer.innerHTML = '';
                        
                        // æ›´æ–°è¿›åº¦
                        pdfProgress.textContent = `æ­£åœ¨å¤„ç†ç¬¬ ${i + 1}/${allPackageNos.length} ä¸ªåŒ…...`;
                    }
                }
                
                // 5. æ·»åŠ ç»“æŸé¡µ
                pdfProgress.textContent = 'ç”Ÿæˆç»“æŸé¡µ...';
                
                const endHTML = `
                    <div style="width: 1100px; padding: 32px; background-color: white; box-sizing: border-box; font-size: 12px;">
                        <div style="text-align: center; height: 100%; display: flex; flex-direction: column; justify-content: center;">
                            <h1 style="color: #2c3e50; font-size: 28px; margin-bottom: 32px;">æŠ¥å‘Šç»“æŸ</h1>
                            <h2 style="color: #3498db; font-size: 20px; margin-bottom: 24px;">${algorithmName} - æŠ•æ ‡ä»·æ ¼è¯„åˆ†æŠ¥å‘Š</h2>
                            
                            <div style="width: 60%; margin: 0 auto; padding-top: 24px;">
                                <div style="padding: 24px; background-color: #f8f9fa; border-radius: 8px; text-align: left;">
                                    <h3 style="color: #2c3e50; margin-top: 0; font-size: 18px;">æŠ¥å‘Šç»Ÿè®¡ä¿¡æ¯</h3>
                                    <div style="margin-top: 16px;">
                                        <p style="color: #333; margin: 8px 0;"><strong>æ€»åŒ…æ•°:</strong> ${Object.keys(calculationResults.packages).length}ä¸ª</p>
                                        <p style="color: #333; margin: 8px 0;"><strong>æ€»æŠ•æ ‡äººæ•°:</strong> ${calculationResults.allBidders.length}ä¸ª</p>
                                        <p style="color: #333; margin: 8px 0;"><strong>åˆæ ¼æŠ•æ ‡äººæ•°:</strong> ${calculationResults.allBidders.filter(b => b.qualified).length}ä¸ª</p>
                                        <p style="color: #333; margin: 8px 0;"><strong>ç”Ÿæˆæ—¶é—´:</strong> ${currentTime}</p>
                                    </div>
                                    
                                    <div style="margin-top: 24px; padding: 16px; background-color: #fff8e1; border-radius: 6px;">
                                        <h4 style="color: #f39c12; margin-top: 0; font-size: 16px;">é‡è¦è¯´æ˜</h4>
                                        <p style="color: #333; margin: 4px 0; font-size: 11px;">1. æœ¬æŠ¥å‘Šç”±"æŠ•æ ‡ä»·æ ¼è¯„åˆ†ä¼°ç®—å·¥å…·"è‡ªåŠ¨ç”Ÿæˆ</p>
                                        <p style="color: #333; margin: 4px 0; font-size: 11px;">2. è®¡ç®—ç»“æœä»…ä¾›å‚è€ƒï¼Œå®é™…è¯„å®¡ç»“æœä»¥æ‹›æ ‡å§”å‘˜ä¼šæœ€ç»ˆç¡®è®¤ä¸ºå‡†</p>
                                        <p style="color: #333; margin: 4px 0; font-size: 11px;">3. æŠ¥å‘Šç”Ÿæˆå·¥å…·ç‰ˆæœ¬: v3.0</p>
                                        <p style="color: #333; margin: 4px 0; font-size: 11px;">4. å¼€å‘è€…: 2026Developer@sy</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                pdfTempContainer.innerHTML = endHTML;
                await convertToPDF(doc, pdfTempContainer);
                pdfTempContainer.innerHTML = '';
                
                // ä¿å­˜PDFæ–‡ä»¶
                pdfProgress.textContent = 'ä¿å­˜PDFæ–‡ä»¶...';
                const algorithmShort = algorithm === 'arithmetic' ? 'ç®—æœ¯æ³•' : 'åŒºé—´æ³•';
                const fileName = `${currentFileName || 'æŠ•æ ‡ä»·æ ¼è¯„åˆ†æ±‡æ€»'}_${algorithmShort}_${new Date().toISOString().slice(0, 10)}.pdf`;
                doc.save(fileName);
                
                // éšè—åŠ è½½æç¤º
                pdfLoading.classList.add('hidden');
                
                // æç¤ºç”¨æˆ·
                alert(`PDFæŠ¥å‘Šç”ŸæˆæˆåŠŸï¼æ–‡ä»¶å·²ä¿å­˜ä¸º: ${fileName}\n\næŠ¥å‘ŠåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\n1. å°é¢é¡µ\n2. æŠ•æ ‡äººæ»¡åˆ†åŒ…ç»Ÿè®¡${includeSummary ? 'ï¼ˆå·²åŒ…å«ï¼‰' : 'ï¼ˆæœªåŒ…å«ï¼‰'}\n3. å„åŒ…æ±‡æ€»è¡¨${includePackageDetails ? 'ï¼ˆå·²åŒ…å«ï¼‰' : 'ï¼ˆæœªåŒ…å«ï¼‰'}\n4. å„åŒ…æŠ•æ ‡äººæ˜ç»†${includeAllBidders ? 'ï¼ˆå·²åŒ…å«ï¼‰' : 'ï¼ˆæœªåŒ…å«ï¼‰'}\n5. ç»“æŸé¡µ`);
                
            } catch (error) {
                console.error('ç”ŸæˆPDFæ—¶å‡ºé”™:', error);
                pdfLoading.classList.add('hidden');
                alert('ç”ŸæˆPDFæŠ¥å‘Šæ—¶å‡ºé”™ï¼Œè¯·é‡è¯•æˆ–æ£€æŸ¥æ•°æ®ã€‚é”™è¯¯ä¿¡æ¯: ' + error.message);
            }
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šå°†HTMLå†…å®¹è½¬æ¢ä¸ºå›¾ç‰‡å¹¶æ·»åŠ åˆ°PDF
        async function convertToPDF(doc, container, isCover = false) {
            return new Promise((resolve, reject) => {
                // ä¸´æ—¶æ˜¾ç¤ºå®¹å™¨
                container.style.visibility = 'visible';
                
                // ç­‰å¾…DOMæ›´æ–°
                setTimeout(() => {
                    html2canvas(container, {
                        scale: 2, // æé«˜åˆ†è¾¨ç‡
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: isCover ? '#f5f7fa' : '#ffffff',
                        logging: false,
                        width: container.scrollWidth,
                        height: container.scrollHeight,
                        windowWidth: container.scrollWidth,
                        windowHeight: container.scrollHeight
                    }).then(canvas => {
                        const imgData = canvas.toDataURL('image/jpeg', 0.9);
                        
                        // è®¡ç®—å›¾ç‰‡å°ºå¯¸ï¼ˆA4æ¨ªå‘ï¼š297mm x 210mmï¼Œå‡å»è¾¹è·ï¼‰
                        const imgWidth = 277; // A4æ¨ªå‘å®½åº¦297mmå‡å»è¾¹è·20mm
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        // æ·»åŠ æ–°é¡µé¢
                        doc.addPage();
                        
                        // æ·»åŠ å›¾ç‰‡åˆ°PDF
                        const xPos = 10;
                        const yPos = 10;
                        const pageHeight = 190; // A4æ¨ªå‘é«˜åº¦210mmå‡å»è¾¹è·20mm
                        
                        if (imgHeight <= pageHeight) {
                            // å›¾ç‰‡å¯ä»¥æ”¾åœ¨ä¸€é¡µ
                            doc.addImage(imgData, 'JPEG', xPos, yPos, imgWidth, imgHeight);
                        } else {
                            // å›¾ç‰‡éœ€è¦åˆ†é¡µ
                            let heightLeft = imgHeight;
                            let position = yPos;
                            
                            // ç¬¬ä¸€é¡µ
                            doc.addImage(imgData, 'JPEG', xPos, position, imgWidth, imgHeight);
                            heightLeft -= pageHeight;
                            
                            // åç»­é¡µ
                            while (heightLeft > 0) {
                                doc.addPage();
                                position = yPos - pageHeight;
                                doc.addImage(imgData, 'JPEG', xPos, position, imgWidth, imgHeight);
                                heightLeft -= pageHeight;
                            }
                        }
                        
                        // éšè—å®¹å™¨
                        container.style.visibility = 'hidden';
                        resolve();
                    }).catch(error => {
                        container.style.visibility = 'hidden';
                        reject(error);
                    });
                }, 100); // ç»™DOMä¸€ç‚¹æ—¶é—´æ›´æ–°
            });
        }
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æ•°æ®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è¾“å…¥å’Œè®¡ç®—ç»“æœã€‚')) {
                // é‡ç½®ç®—æ³•é€‰æ‹©
                selectMethod('arithmetic');
                
                // é‡ç½®åŒºé—´å¤åˆå¹³å‡ä»·æ³•å‚æ•°
                document.getElementById('intervalLower').value = -10;
                document.getElementById('intervalUpper').value = 10;
                document.getElementById('n1').value = 2.0;
                document.getElementById('n2').value = 1.0;
                updateIntervalParamsDisplay();
                
                // é‡ç½®æµ®åŠ¨ç³»æ•°
                document.getElementById('floatCoefficient').value = '-0.25';
                
                // æ¸…ç©ºæ–‡ä»¶ä¿¡æ¯
                document.getElementById('fileInfo').innerHTML = '';
                currentFileName = '';
                
                // æ¸…ç©ºè¡¨æ ¼
                const tableBody = document.getElementById('bidTableBody');
                tableBody.innerHTML = '';
                
                // æ¸…ç©ºç»“æœå®¹å™¨
                document.getElementById('packageResultsContainer').innerHTML = '';
                document.getElementById('summaryContainer').innerHTML = '';
                
                // é‡ç½®è®¡ç®—ç»“æœ
                calculationResults = {
                    packages: {},
                    allBidders: [],
                    bidderFullScoreStats: {},
                    currentAlgorithm: 'arithmetic'
                };
                
                // é‡ç½®PDFé€‰é¡¹
                document.getElementById('includeSummary').checked = true;
                document.getElementById('includePackageDetails').checked = true;
                document.getElementById('includeAllBidders').checked = true;
                
                // æ·»åŠ å‡ è¡Œç©ºæ•°æ®
                for (let i = 0; i < 3; i++) {
                    addRow();
                }
            }
        }
        
        // å·¥å…·ç®±åŠŸèƒ½å®ç°
        function initToolbox() {
            // Wordè½¬PPTå·¥å…·
            document.getElementById('wordToPPT').addEventListener('click', function() {
                alert('Wordè½¬PPTåŠŸèƒ½ï¼šè¯·ä¸Šä¼ Wordæ–‡æ¡£ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è½¬æ¢ä¸ºPPTæ ¼å¼ã€‚\n\næ³¨æ„ï¼šæ­¤åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒï¼Œå½“å‰ä¸ºæ¼”ç¤ºç‰ˆæœ¬ã€‚');
                
                // åˆ›å»ºæ–‡ä»¶è¾“å…¥
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.doc,.docx,.txt';
                fileInput.style.display = 'none';
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        alert(`å·²é€‰æ‹©æ–‡ä»¶: ${file.name}\næ–‡ä»¶å¤§å°: ${(file.size / 1024).toFixed(2)} KB\n\nWordè½¬PPTåŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
                    }
                });
                
                document.body.appendChild(fileInput);
                fileInput.click();
                setTimeout(() => {
                    document.body.removeChild(fileInput);
                }, 100);
            });
            
            // PDFæ–‡å­—æå–å·¥å…·
            document.getElementById('pdfTextExtract').addEventListener('click', function() {
                alert('PDFæ–‡å­—æå–åŠŸèƒ½ï¼šä¸Šä¼ PDFæ–‡ä»¶ï¼Œæå–æ‰€æœ‰æ–‡å­—å¹¶æŒ‰ç…§æ®µè½æ•´ç†æˆæ–‡æœ¬ï¼Œåˆ é™¤æ— å…³ç¬¦å·ï¼Œä¿ç•™åŸæ ¼å¼ã€‚\n\næ³¨æ„ï¼šæ­¤åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒï¼Œå½“å‰ä¸ºæ¼”ç¤ºç‰ˆæœ¬ã€‚');
                
                // åˆ›å»ºæ–‡ä»¶è¾“å…¥
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.pdf';
                fileInput.style.display = 'none';
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        alert(`å·²é€‰æ‹©PDFæ–‡ä»¶: ${file.name}\næ–‡ä»¶å¤§å°: ${(file.size / 1024).toFixed(2)} KB\n\nPDFæ–‡å­—æå–åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
                    }
                });
                
                document.body.appendChild(fileInput);
                fileInput.click();
                setTimeout(() => {
                    document.body.removeChild(fileInput);
                }, 100);
            });
            
            // AI På›¾å·¥å…·
            document.getElementById('aiPhotoEdit').addEventListener('click', function() {
                alert('AI På›¾å·¥å…·ï¼šä¸Šä¼ å›¾ç‰‡ï¼Œä½¿ç”¨AIæŠ€æœ¯è¿›è¡Œæ™ºèƒ½ç¼–è¾‘å¤„ç†ã€‚\n\næ³¨æ„ï¼šæ­¤åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒï¼Œå½“å‰ä¸ºæ¼”ç¤ºç‰ˆæœ¬ã€‚');
                
                // åˆ›å»ºæ–‡ä»¶è¾“å…¥
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = 'image/*';
                fileInput.style.display = 'none';
                fileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        alert(`å·²é€‰æ‹©å›¾ç‰‡: ${file.name}\næ–‡ä»¶å¤§å°: ${(file.size / 1024).toFixed(2)} KB\n\nAI På›¾åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼`);
                    }
                });
                
                document.body.appendChild(fileInput);
                fileInput.click();
                setTimeout(() => {
                    document.body.removeChild(fileInput);
                }, 100);
            });
        }
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        function updateButtonStates() {
            const calculateBtn = document.getElementById('calculateBtn');
            const exportBtn = document.getElementById('exportBtn');
            const pdfBtn = document.getElementById('pdfBtn');
            
            if (checkUsage()) {
                calculateBtn.disabled = false;
                exportBtn.disabled = false;
                pdfBtn.disabled = false;
            } else {
                calculateBtn.disabled = true;
                exportBtn.disabled = true;
                pdfBtn.disabled = true;
            }
        }
        
        // å¼€å‘è€…ç®¡ç†å·¥å…·ç«¯éœ€è¦ä½¿ç”¨çš„å‡½æ•°ï¼ˆæä¾›ç»™å¼€å‘è€…ï¼‰
        // ç”Ÿæˆæˆæƒç çš„å‡½æ•°ï¼ˆå¼€å‘è€…ä½¿ç”¨ï¼‰
        function generateLicenseCodeForDeveloper(authRequestCode, amount, times, machineCode) {
            // è§£ææˆæƒè¯·æ±‚ç 
            const parts = authRequestCode.split('-');
            if (parts.length !== 4 || parts[0] !== 'AUTH' || parts[1] !== 'REQ') {
                return null;
            }
            
            // æ ¹æ®é‡‘é¢ç¡®å®šç±»å‹ä»£ç 
            let typeCode = '001';
            if (amount === 18) typeCode = '003';
            else if (amount === 58) typeCode = '010';
            else if (amount === 88) typeCode = '999';
            
            const timestamp = parts[2];
            const randomStr = parts[3];
            
            // ç”Ÿæˆç­¾å
            const signature = generateSignature(typeCode, timestamp, randomStr);
            
            // ç”Ÿæˆæˆæƒç 
            const licenseCode = `AUTH-${typeCode}-${timestamp}-${randomStr}-${signature}`;
            
            return licenseCode;
        }
    </script>
</body>
</html>